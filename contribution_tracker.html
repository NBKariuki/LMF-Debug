<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Contribution Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            font-size: 11px;
            line-height: 1.2;
            overflow-x: hidden;
            background: #fff;
        }
        
        #loading {
            padding: 20px;
            text-align: center;
            color: #666;
        }
        
        #error {
            padding: 20px;
            color: #d32f2f;
            display: none;
        }
        
        .table-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        .table-wrapper {
            display: flex;
            height: 100%;
            overflow: hidden;
        }
        
        /* Frozen columns (left ~30% of screen) */
        .frozen-columns {
            width: 30%;
            max-width: 30vw;
            flex-shrink: 0;
            overflow-y: auto;
            overflow-x: hidden;
            border-right: 1px solid #e0e0e0;
            background: #fafafa;
        }
        
        /* Scrollable columns (right ~70% of screen) */
        .scrollable-columns {
            width: 70%;
            flex-grow: 1;
            overflow: auto;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
        }
        
        th, td {
            padding: 4px 6px;
            text-align: left;
            border: 0.5px solid #e0e0e0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        th {
            background: #f5f5f5;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 10px;
            padding: 6px 4px;
        }
        
        /* Banded rows - alternating colors */
        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tbody tr:nth-child(odd) {
            background-color: #ffffff;
        }
        
        /* Number alignment */
        td.number {
            text-align: right;
            font-variant-numeric: tabular-nums;
        }
        
        /* Compact frozen columns */
        .frozen-columns th,
        .frozen-columns td {
            max-width: 15vw;
            font-size: 10px;
        }
        
        /* Compact scrollable columns */
        .scrollable-columns th,
        .scrollable-columns td {
            min-width: 60px;
            max-width: 80px;
        }
        
        /* Sync scroll between frozen header and body */
        .frozen-columns {
            scrollbar-width: thin;
        }
        
        .scrollable-columns {
            scrollbar-width: thin;
        }
        
        /* Loading spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="spinner"></div>
        <p>Loading data...</p>
    </div>
    <div id="error"></div>
    <div id="tableContainer" class="table-container" style="display: none;"></div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQfQdBVl01cxsIoGnfJLltGDuOkIVDFqj-rNg3KwFVZ8-GGbUqk1DSs_CVaygisjaLhg30g1gjzIsdC/pub?output=csv';
        
        function parseCSV(text) {
            const lines = [];
            let currentLine = [];
            let currentField = '';
            let inQuotes = false;
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const nextChar = text[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        currentField += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    currentLine.push(currentField);
                    currentField = '';
                } else if ((char === '\n' || char === '\r') && !inQuotes) {
                    if (currentField || currentLine.length > 0) {
                        currentLine.push(currentField);
                        lines.push(currentLine);
                        currentLine = [];
                        currentField = '';
                    }
                    if (char === '\r' && nextChar === '\n') {
                        i++;
                    }
                } else {
                    currentField += char;
                }
            }
            
            if (currentField || currentLine.length > 0) {
                currentLine.push(currentField);
                lines.push(currentLine);
            }
            
            return lines;
        }
        
        function isNumeric(value) {
            if (!value || value.trim() === '') return false;
            const num = value.replace(/,/g, '');
            return !isNaN(num) && !isNaN(parseFloat(num));
        }
        
        function formatNumber(value) {
            const num = parseFloat(value.replace(/,/g, ''));
            if (isNaN(num)) return value;
            return Math.round(num).toLocaleString('en-US');
        }
        
        function createTable(data) {
            if (!data || data.length === 0) {
                throw new Error('No data found');
            }
            
            const headers = data[0];
            const rows = data.slice(1).filter(row => row.some(cell => cell && cell.trim()));
            
            if (headers.length < 3) {
                throw new Error('Need at least 3 columns (2 frozen + 1 scrollable)');
            }
            
            // Create frozen columns table
            const frozenTable = document.createElement('table');
            const frozenThead = document.createElement('thead');
            const frozenTbody = document.createElement('tbody');
            
            // Frozen header
            const frozenHeaderRow = document.createElement('tr');
            for (let i = 0; i < 2; i++) {
                const th = document.createElement('th');
                th.textContent = headers[i] || '';
                frozenHeaderRow.appendChild(th);
            }
            frozenThead.appendChild(frozenHeaderRow);
            
            // Frozen body
            rows.forEach(row => {
                const tr = document.createElement('tr');
                for (let i = 0; i < 2; i++) {
                    const td = document.createElement('td');
                    const value = row[i] || '';
                    td.textContent = value;
                    tr.appendChild(td);
                }
                frozenTbody.appendChild(tr);
            });
            
            frozenTable.appendChild(frozenThead);
            frozenTable.appendChild(frozenTbody);
            
            // Create scrollable columns table
            const scrollTable = document.createElement('table');
            const scrollThead = document.createElement('thead');
            const scrollTbody = document.createElement('tbody');
            
            // Scrollable header
            const scrollHeaderRow = document.createElement('tr');
            for (let i = 2; i < headers.length; i++) {
                const th = document.createElement('th');
                th.textContent = headers[i] || '';
                scrollHeaderRow.appendChild(th);
            }
            scrollThead.appendChild(scrollHeaderRow);
            
            // Scrollable body
            rows.forEach(row => {
                const tr = document.createElement('tr');
                for (let i = 2; i < headers.length; i++) {
                    const td = document.createElement('td');
                    const value = row[i] || '';
                    
                    if (isNumeric(value)) {
                        td.textContent = formatNumber(value);
                        td.classList.add('number');
                    } else {
                        td.textContent = value;
                    }
                    tr.appendChild(td);
                }
                scrollTbody.appendChild(tr);
            });
            
            scrollTable.appendChild(scrollThead);
            scrollTable.appendChild(scrollTbody);
            
            // Create container structure
            const container = document.getElementById('tableContainer');
            container.innerHTML = '';
            
            const wrapper = document.createElement('div');
            wrapper.className = 'table-wrapper';
            
            const frozenDiv = document.createElement('div');
            frozenDiv.className = 'frozen-columns';
            frozenDiv.appendChild(frozenTable);
            
            const scrollDiv = document.createElement('div');
            scrollDiv.className = 'scrollable-columns';
            scrollDiv.appendChild(scrollTable);
            
            wrapper.appendChild(frozenDiv);
            wrapper.appendChild(scrollDiv);
            container.appendChild(wrapper);
            
            // Sync vertical scroll between frozen and scrollable sections
            frozenDiv.addEventListener('scroll', () => {
                scrollDiv.scrollTop = frozenDiv.scrollTop;
            });
            
            scrollDiv.addEventListener('scroll', () => {
                frozenDiv.scrollTop = scrollDiv.scrollTop;
            });
            
            container.style.display = 'block';
            document.getElementById('loading').style.display = 'none';
        }
        
        async function loadData() {
            try {
                const response = await fetch(CSV_URL);
                if (!response.ok) {
                    throw new Error(`Failed to fetch: ${response.status} ${response.statusText}`);
                }
                
                const text = await response.text();
                const data = parseCSV(text);
                createTable(data);
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').style.display = 'none';
                const errorDiv = document.getElementById('error');
                errorDiv.textContent = `Error loading data: ${error.message}. Pull down to refresh.`;
                errorDiv.style.display = 'block';
            }
        }
        
        // Load data on page load
        loadData();
    </script>
</body>
</html>
