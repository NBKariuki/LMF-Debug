<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0d0f14">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<title>Like-Minded Folks ¬∑ MMF Tracker</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%230d0f14%22/><text x=%2250%22 y=%2268%22 font-family=%22Arial,sans-serif%22 font-size=%2248%22 font-weight=%22700%22 fill=%22%2300c87a%22 text-anchor=%22middle%22>L</text></svg>">
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Sora:wght@400;600;700;800&family=JetBrains+Mono:wght@500;600&display=swap" rel="stylesheet">
<style>
:root{--accent:#00c87a;--accent-l:rgba(0,200,122,.13);--blue:#3b82f6;--blue-l:rgba(59,130,246,.13);--gold:#f59e0b;--gold-l:rgba(245,158,11,.13);--red:#ef4444;--red-l:rgba(239,68,68,.12);--r-sm:10px;--r-md:16px;--r-lg:22px;--r-xl:30px;--tr:.25s ease;}
[data-theme="dark"]{--bg:#0d0f14;--bg2:#12151c;--card:#181c26;--card2:#1e2232;--border:rgba(255,255,255,.07);--border2:rgba(255,255,255,.14);--t1:#eef0f8;--t2:rgba(238,240,248,.60);--t3:rgba(238,240,248,.32);--shadow:0 4px 24px rgba(0,0,0,.45);--shadow-lg:0 8px 40px rgba(0,0,0,.55);--blob1:rgba(0,200,122,.18);--blob2:rgba(59,130,246,.15);--blob3:rgba(139,92,246,.12);--input-bg:rgba(255,255,255,.05);--sw-bg:rgba(255,255,255,.10);}
[data-theme="light"]{--bg:#f0f4f2;--bg2:#e8ede9;--card:#ffffff;--card2:#f7faf8;--border:rgba(0,0,0,.07);--border2:rgba(0,0,0,.13);--t1:#111827;--t2:rgba(17,24,39,.60);--t3:rgba(17,24,39,.35);--shadow:0 4px 24px rgba(0,0,0,.08);--shadow-lg:0 8px 40px rgba(0,0,0,.13);--blob1:rgba(0,200,122,.22);--blob2:rgba(59,130,246,.18);--blob3:rgba(139,92,246,.15);--input-bg:rgba(0,0,0,.04);--sw-bg:rgba(0,0,0,.10);}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html{font-size:16px;}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--t1);min-height:100svh;overscroll-behavior:none;transition:background var(--tr),color var(--tr);}
button,select,input{touch-action:manipulation;font-family:inherit;}

/* PASSWORD */
.pw-screen{min-height:100svh;display:flex;align-items:center;justify-content:center;padding:24px;background:var(--bg);}
.pw-card{background:var(--card);border:1px solid var(--border2);border-radius:var(--r-xl);padding:40px 32px;width:100%;max-width:360px;box-shadow:var(--shadow-lg);display:flex;flex-direction:column;align-items:center;gap:6px;animation:fadeUp .4s ease;}
.pw-lock{font-size:2.4rem;margin-bottom:6px;}
.pw-title{font-family:'Sora',sans-serif;font-size:1.5rem;font-weight:800;}
.pw-sub{font-size:.82rem;color:var(--t3);margin-bottom:16px;text-align:center;}
.pw-input{width:100%;padding:13px 16px;background:var(--input-bg);border:1px solid var(--border2);border-radius:var(--r-md);color:var(--t1);font-size:1rem;font-family:inherit;outline:none;transition:border-color .2s;}
.pw-input:focus{border-color:var(--accent);}
.pw-input.err{border-color:var(--red);}
.pw-err{color:var(--red);font-size:.78rem;min-height:18px;align-self:flex-start;}
.pw-btn{width:100%;padding:14px;background:var(--accent);color:#fff;border:none;border-radius:var(--r-md);font-size:1rem;font-weight:700;cursor:pointer;margin-top:4px;transition:opacity .2s;}
.pw-btn:hover{opacity:.88;}
.pw-help{font-size:.74rem;color:var(--t3);text-align:center;margin-top:8px;}

/* APP SHELL */
.app-shell{max-width:430px;margin:0 auto;min-height:100svh;display:flex;flex-direction:column;position:relative;overflow-x:hidden;}

/* HEADER */
.app-header{padding:20px 20px 0;display:flex;flex-direction:column;position:relative;z-index:10;}
.app-header-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px;}
.app-eyebrow{font-size:.62rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:var(--accent);margin-bottom:2px;}
.app-title{font-family:'Sora',sans-serif;font-size:1.75rem;font-weight:800;line-height:1.1;letter-spacing:-.02em;}
.app-subtitle{font-size:.8rem;color:var(--t2);margin-top:2px;transition:color var(--tr);}
[data-theme="light"] .app-subtitle{color:var(--accent);font-weight:600;}
.theme-toggle{width:52px;height:28px;border-radius:20px;background:var(--sw-bg);border:1px solid var(--border2);cursor:pointer;position:relative;flex-shrink:0;transition:background .25s;display:flex;align-items:center;padding:3px;}
.theme-knob{width:22px;height:22px;border-radius:50%;background:var(--card);display:flex;align-items:center;justify-content:center;font-size:.75rem;box-shadow:0 2px 6px rgba(0,0,0,.25);transition:transform .25s cubic-bezier(.4,0,.2,1);transform:translateX(0);}
[data-theme="light"] .theme-knob{transform:translateX(24px);}
[data-theme="light"] .theme-toggle{background:var(--accent-l);border-color:var(--accent);}

/* GREETING */
.greeting{padding:18px 20px 6px;}
.greeting-time{font-family:'Sora',sans-serif;font-size:2rem;font-weight:400;color:var(--t1);line-height:1.2;}
.greeting-inspo{font-size:.82rem;color:var(--t2);margin-top:6px;line-height:1.5;max-width:320px;}

/* TAB NAV */
.tab-nav{padding:0 20px;margin-top:16px;display:flex;gap:0;border-bottom:1.5px solid var(--border);position:sticky;top:0;z-index:50;background:var(--bg);padding-top:4px;transition:background var(--tr);}
.tab-btn{padding:10px 18px 11px;background:transparent;border:none;color:var(--t3);font-family:'DM Sans',sans-serif;font-size:.9rem;font-weight:600;cursor:pointer;position:relative;transition:color .2s;white-space:nowrap;}
.tab-btn.active{color:var(--t1);}
.tab-btn.active::after{content:'';position:absolute;bottom:-1.5px;left:0;right:0;height:2.5px;background:var(--accent);border-radius:2px 2px 0 0;}

/* TAB PANELS */
.tab-panel{display:none;padding:0 0 80px;animation:fadeUp .3s ease;}
.tab-panel.active{display:block;}

/* OVERVIEW HERO */
.overview-hero{padding:24px 20px 8px;}
.hero-label{font-size:.78rem;color:var(--t2);margin-bottom:4px;font-weight:500;}
.hero-amount{font-family:'Sora',sans-serif;font-size:3rem;font-weight:800;line-height:1;letter-spacing:-.03em;color:var(--t1);}
.hero-sub{display:flex;align-items:center;gap:8px;margin-top:8px;font-size:.78rem;color:var(--t2);}
.hero-pill{display:inline-flex;align-items:center;gap:4px;background:var(--accent-l);color:var(--accent);padding:3px 10px;border-radius:20px;font-size:.74rem;font-weight:700;border:1px solid rgba(0,200,122,.2);}

/* BLOB ZONE */
.blob-zone{position:relative;margin-top:16px;padding:0 20px 24px;overflow:visible;min-height:340px;}
.blob-zone::before,.blob-zone::after{content:'';position:absolute;border-radius:50%;filter:blur(40px);pointer-events:none;z-index:0;}
.blob-zone::before{width:200px;height:200px;background:var(--blob1);bottom:-20px;right:-30px;}
.blob-zone::after{width:160px;height:160px;background:var(--blob2);bottom:60px;left:-20px;}
.blob-extra{position:absolute;width:120px;height:120px;border-radius:50%;background:var(--blob3);filter:blur(35px);pointer-events:none;bottom:0;right:80px;z-index:0;}

/* STACKED CARDS */
.stack-cards{position:relative;z-index:1;}
.stack-card{border-radius:var(--r-xl);padding:20px 22px;display:flex;align-items:center;gap:14px;box-shadow:var(--shadow);transition:transform .2s,box-shadow .2s;cursor:pointer;position:relative;}
.stack-card:active{transform:scale(.97);}
.stack-card-1{background:linear-gradient(135deg,#1e6ef0 0%,#06c0f0 100%);margin-bottom:-18px;z-index:3;}
.stack-card-2{background:linear-gradient(135deg,#00b87a 0%,#22d9a0 100%);margin-bottom:-18px;z-index:2;padding-top:28px;}
.stack-card-3{background:linear-gradient(135deg,#6ee7f7 0%,#a8f0df 100%);cursor:default;z-index:1;padding-top:28px;padding-bottom:24px;}
[data-theme="dark"] .stack-card-3{background:linear-gradient(135deg,#1a4a5e 0%,#1a5e4a 100%);}
.stack-card-icon{width:44px;height:44px;border-radius:14px;background:rgba(255,255,255,.22);display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;}
.stack-card-label{font-family:'Sora',sans-serif;font-size:1.1rem;font-weight:700;color:#fff;flex:1;}
.stack-card-arrow{color:rgba(255,255,255,.7);font-size:1rem;}
.stack-card-3 .stack-card-label{color:#0a2a22;}
[data-theme="dark"] .stack-card-3 .stack-card-label{color:#d4f7ee;}
.card3-stats{width:100%;padding:0 22px 22px;}
.card3-row{display:flex;align-items:baseline;gap:8px;margin-bottom:10px;}
.card3-row:last-child{margin-bottom:0;}
.card3-num{font-family:'Sora',sans-serif;font-size:1.6rem;font-weight:800;color:#0a2a22;line-height:1;}
[data-theme="dark"] .card3-num{color:#d4f7ee;}
.card3-lbl{font-size:.72rem;font-weight:600;color:rgba(10,42,34,.65);line-height:1.3;}
[data-theme="dark"] .card3-lbl{color:rgba(212,247,238,.65);}
.card3-big{font-size:2rem;}

/* INNER VIEW */
.inner-view{padding:0 20px;animation:fadeUp .25s ease;}
.inner-back{display:flex;align-items:center;gap:8px;padding:14px 0 10px;color:var(--t2);font-size:.88rem;font-weight:600;cursor:pointer;background:transparent;border:none;}
.inner-back:hover{color:var(--t1);}
.inner-title{font-family:'Sora',sans-serif;font-size:1.2rem;font-weight:800;margin-bottom:14px;}

/* CHART CARD */
.chart-card{background:var(--card);border:1px solid var(--border);border-radius:var(--r-lg);padding:16px;margin-bottom:14px;box-shadow:var(--shadow);}
.chart-label{font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(--t3);margin-bottom:2px;}
.chart-sub{font-size:.72rem;color:var(--t3);margin-bottom:10px;}

/* MEMBERS TABLE */
.members-table-wrap{background:var(--card);border:1px solid var(--border);border-radius:var(--r-lg);overflow:hidden;box-shadow:var(--shadow);margin-bottom:12px;}
.members-table{width:100%;border-collapse:collapse;font-size:.82rem;}
.members-table thead{background:var(--card2);}
.members-table th{padding:10px;text-align:right;color:var(--t3);font-size:.65rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;border-bottom:1px solid var(--border);}
.members-table th:first-child,.members-table th:nth-child(2){text-align:left;}
.members-table td{padding:10px;text-align:right;border-bottom:1px solid var(--border);color:var(--t2);}
.members-table td:first-child{text-align:left;color:var(--t3);font-size:.72rem;}
.members-table td:nth-child(2){text-align:left;color:var(--t1);font-weight:600;}
.members-table tbody tr:last-child td{border-bottom:none;}
.members-table .total-row td{background:var(--card2);color:var(--t1);font-weight:700;border-top:1px solid var(--border2);border-bottom:none;}
.members-table .total-row td:first-child{color:var(--t3);}
.num-col{font-family:'JetBrains Mono',monospace;font-size:.78rem;}
.closing-col{color:var(--accent)!important;font-weight:700!important;}
.topup-cell{display:flex;align-items:center;justify-content:flex-end;gap:5px;}
.status-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.data-ts{font-size:.65rem;color:var(--t3);text-align:center;padding:8px 0;}

/* MY BALANCE */
.balance-pad{padding:16px 20px 0;}
.month-scroll{display:flex;gap:7px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none;margin-bottom:16px;}
.month-scroll::-webkit-scrollbar{display:none;}
.month-pill{padding:7px 14px;border-radius:20px;border:1px solid var(--border2);background:transparent;color:var(--t3);font-size:.78rem;font-weight:700;cursor:pointer;white-space:nowrap;flex-shrink:0;transition:all .15s;}
.month-pill.active{background:var(--accent);color:#fff;border-color:var(--accent);}
.alias-card{background:var(--card);border:1px solid var(--border2);border-radius:var(--r-lg);padding:16px;margin-bottom:14px;box-shadow:var(--shadow);}
.alias-card-label{font-size:.65rem;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(--t3);margin-bottom:8px;}
.alias-select{width:100%;padding:12px 14px;background:var(--input-bg);border:1px solid var(--border2);border-radius:var(--r-md);color:var(--t1);font-family:'DM Sans',sans-serif;font-size:.95rem;font-weight:600;outline:none;cursor:pointer;transition:border-color .2s;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='rgba(200,200,220,0.5)' d='M0 0l6 8 6-8z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:36px;}
.alias-select:focus{border-color:var(--accent);}
.alias-select option{background:var(--card);}

/* STATEMENT CARD */
.statement-card{background:var(--card);border:1px solid var(--border);border-radius:var(--r-lg);padding:20px;margin-bottom:14px;box-shadow:var(--shadow);animation:fadeUp .3s ease;}
.stmt-alias{font-family:'Sora',sans-serif;font-size:1.4rem;font-weight:800;margin-bottom:2px;}
.stmt-month{font-size:.78rem;color:var(--t3);margin-bottom:18px;}
.stmt-row{display:flex;justify-content:space-between;align-items:center;padding:11px 0;border-bottom:1px solid var(--border);}
.stmt-row:last-child{border-bottom:none;padding-bottom:0;}
.stmt-label{font-size:.88rem;color:var(--t2);}
.stmt-value{font-family:'JetBrains Mono',monospace;font-size:.9rem;font-weight:600;color:var(--t1);}
.stmt-value.blue{color:var(--blue);}
.stmt-value.grn{color:var(--accent);}
.stmt-value.hero{font-size:1.5rem;color:var(--accent);font-family:'Sora',sans-serif;font-weight:800;}
.stmt-label-hero{font-size:.95rem;font-weight:700;color:var(--t1);}
.early-hint{font-size:.62rem;color:var(--gold);margin-top:2px;}
.stmt-ts{font-size:.65rem;color:var(--t3);text-align:right;margin-top:10px;}

/* WARNING */
.warning-card{background:var(--gold-l);border:1px solid rgba(245,158,11,.2);border-radius:var(--r-md);padding:14px 16px;margin-bottom:14px;display:flex;gap:12px;align-items:flex-start;}
.warning-icon{font-size:1.2rem;flex-shrink:0;}
.warning-title{font-size:.8rem;font-weight:700;color:var(--gold);margin-bottom:3px;}
.warning-body{font-size:.78rem;color:var(--t2);line-height:1.5;}

/* MOTIVATION */
.motivation-card{background:var(--card);border:1px solid var(--border);border-radius:var(--r-lg);padding:16px;margin-bottom:14px;display:flex;gap:12px;align-items:flex-start;box-shadow:var(--shadow);}
.motivation-icon{font-size:1.4rem;flex-shrink:0;}
.motivation-text{font-size:.84rem;color:var(--t2);line-height:1.6;}

/* EMPTY STATE */
.empty-state{text-align:center;padding:40px 20px;color:var(--t3);font-size:.88rem;}
.empty-icon{font-size:2rem;margin-bottom:10px;}

/* MORE+ */
.more-pad{padding:16px 20px 0;display:flex;flex-direction:column;gap:12px;}
.more-card{background:var(--card);border:1px solid var(--border);border-radius:var(--r-lg);overflow:hidden;box-shadow:var(--shadow);}
.more-card-head{padding:13px 16px;border-bottom:1px solid var(--border);font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(--t3);display:flex;align-items:center;gap:7px;}
.more-card-body{padding:14px 16px;}
.deposit-method{background:var(--input-bg);border:1px solid var(--border);border-radius:var(--r-md);padding:12px;margin-bottom:8px;}
.deposit-method:last-child{margin-bottom:0;}
.dep-title{font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:var(--blue);margin-bottom:6px;}
.dep-info{font-size:.82rem;color:var(--t2);line-height:1.7;}
.dep-info strong{color:var(--t1);font-family:'JetBrains Mono',monospace;font-size:.82rem;}
.dep-warn{margin-top:8px;padding:8px 10px;background:var(--gold-l);border:1px solid rgba(245,158,11,.2);border-radius:8px;font-size:.74rem;color:var(--gold);line-height:1.4;}
.rules-list{list-style:none;}
.rules-list li{display:flex;align-items:flex-start;gap:8px;padding:6px 0;border-bottom:1px solid var(--border);font-size:.84rem;color:var(--t2);line-height:1.5;}
.rules-list li:last-child{border-bottom:none;}
.rules-list li::before{content:'‚Äî';color:var(--accent);font-weight:700;flex-shrink:0;}
.rules-list strong{color:var(--t1);}
.pdf-pw{font-size:.68rem;color:var(--gold);margin-bottom:8px;text-align:right;}
.stmt-select{width:100%;padding:11px 13px;background:var(--accent-l);color:var(--accent);border:1px solid rgba(0,200,122,.22);border-radius:var(--r-md);font-family:'DM Sans',sans-serif;font-size:.88rem;font-weight:700;cursor:pointer;outline:none;-webkit-appearance:none;appearance:none;}
.stmt-select option{background:var(--card);color:var(--t1);}

/* PRIVACY */
.privacy-notice{margin:16px 20px 0;padding:12px 14px;background:var(--gold-l);border:1px solid rgba(245,158,11,.18);border-radius:var(--r-md);font-size:.78rem;color:var(--t2);line-height:1.5;text-align:center;}
.privacy-notice strong{color:var(--t1);}

/* LOADING */
.loading-screen{min-height:100svh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;color:var(--t3);font-size:.88rem;}
.loader{width:32px;height:32px;border:3px solid var(--border2);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite;}

@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef, useCallback } = React;

const MEMBERS = ['Tokyo','Berlin','Gandia','Denver','Helsinki','Oslo','Moscow',
    'California','Lisbon','Stockholm','Paris','Marseille','Rio','Nairobi',
    'Tel Aviv','Valencia','Havana','Manilla','Scofield','Bogota',
    'Emirates','Dublin','Doha','Bern'];

const MONTHS = ['January','February','March','April','May','June',
    'July','August','September','October','November','December'];

const ENCODED_CSV_URLS = [
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTE4ODE3NjExNTQmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTExODIwNzc2Mjcmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTExNDkyMjYwMjQmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTk2MjExMTcwNCZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTUxNDQ5Mjc4MiZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTU5OTQ2MTg1NyZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTcwMzc5MjUzMCZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTIwOTM3MDg5Nzkmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTEwNzkyMzcwNDMmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTM2MjM4OTY0MCZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTM1MDMxNTkyMiZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTEwMTY1NjE3OTgmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg=="
];

const MONTH_CSV_URLS = {};
MONTHS.forEach((m,i) => { MONTH_CSV_URLS[m] = atob(ENCODED_CSV_URLS[i]); });

const MINIMUM_CONTRIBUTION = 4000;
const ETICA_ANNUAL_YIELD   = 0.12;
const ETICA_MONTHLY_YIELD  = ETICA_ANNUAL_YIELD / 12;
const WARNING_START_DAY    = 10;
const CORRECT_PASSWORD     = 'LikeMinded2026';
const AUTH_EXPIRY_DAYS     = 30;
const CURRENT_YEAR         = new Date().getFullYear();

const MEMBER_PAIRS = {
    'California':'Lisbon','Lisbon':'California',
    'Paris':'Marseille','Marseille':'Paris'
};

        const PARTIAL_CONTRIBUTION_MESSAGES = [
            (a,r) => `Hey there! üëã You've put in KES ${a.toLocaleString()} this month. Just KES ${r.toLocaleString()} more and you're all set for interest. You've got this! üí™`,
            (a,r) => `Nice start! üåü You're at KES ${a.toLocaleString()} so far. Top up KES ${r.toLocaleString()} more to unlock this month's interest. Almost there!`,
            (a,r) => `Good progress! üéØ Your KES ${a.toLocaleString()} is working. Add KES ${r.toLocaleString()} more to hit the minimum and earn interest. Keep going!`,
            (a,r) => `You're on the right track! üöÄ KES ${a.toLocaleString()} down, KES ${r.toLocaleString()} to go. Top up soon!`,
            (a,r) => `Almost there! üòä You've contributed KES ${a.toLocaleString()}. Just KES ${r.toLocaleString()} more to qualify for interest this month!`
        ];
        
        const CURRENT_YEAR = new Date().getFullYear();

        const ARCHETYPE_MESSAGES = {
            OVERACHIEVER: [
                { icon: 'üèÜ', text: "You're in the top 3! At this pace, you're on track for **{projected}** by December. Your early deposits are earning you way more interest than late contributors." },
                { icon: 'üíé', text: "Star performer! You've earned **{interest}** in interest so far. Keep this up!" },
                { icon: 'üöÄ', text: "Your balance is growing faster than **{percentBeaten}%** of the group. December projection: **{projected}**." },
                { icon: 'üî•', text: "On fire! You're projected to hit **{projected}** by December. **{stretchGoal}** is totally within reach." },
                { icon: 'üëë', text: "Top tier! You've contributed **{totalTopups}** so far. December you will have **{projected}**. That's a serious emergency fund." },
            ],
            STEADY_CLIMBER: [
                { icon: 'üå±', text: "Solid progress! Projected **{projected}** by December. Just **KES 1,000 more/month** pushes that to **{stretchGoal}**." },
                { icon: 'üí™', text: "Consistent wins! If you deposited **3 days earlier** each month, you'd earn **KES 200+ more interest** by December." },
                { icon: 'üìà', text: "Steady climb! Your average deposit is **{avgDeposit}**/month. December: **{projected}** with **{projectedInterest}** in interest." },
                { icon: 'üö∂', text: "One step at a time! On track for **{projected}** by December. **{monthsLeft}** months of steady contributions away." },
                { icon: 'üéä', text: "You're doing great! **{percentBeaten}%** of members are behind you. Keep going and you'll crack **{projected}** by December." }
            ],
            LATE_BLOOMER: [
                { icon: 'üî•', text: "Look at you go! From **{previousMonthTopup}** last month to **{currentMonthTopup}** this month. Keep this momentum and you'll hit **{projected}** by December." },
                { icon: 'üåÖ', text: "Late bloomer alert! You're gaining speed. **{avgDeposit}**/month ‚Üí **{projected}** by year-end." },
                { icon: 'üìà', text: "Upward trajectory! Last: **{previousMonthTopup}**. Now: **{currentMonthTopup}**. Next month? Hit **{suggestedNextDeposit}** and you're on a roll." },
                { icon: 'üéØ', text: "You're catching up fast! **{totalTopups}** total ‚Üí **{projected}** by December. That's real money!" },
                { icon: 'üéâ', text: "Progress party! You've more than doubled your deposit this month. December: **{projected}**." }
            ],
            PARTIAL_CONTRIBUTOR: [
                { icon: 'üéØ', text: "You've put in {currentMonthTopup} this month. Just {gapToMinimum} away from qualifying for interest. Doable!" },
                { icon: 'üíö', text: "Good news: {similarMembers} members started at your level and hit the minimum by month-end. Just {gapToMinimum} more!" },
                { icon: '‚è∞', text: "You still have time left in the month. {gapToMinimum} is all you need to qualify for interest." },
                { icon: 'üå±', text: "Every shilling counts! Add {gapToMinimum} more and you'll earn interest this month." },
                { icon: 'üí™', text: "You're {gapToMinimum} away from interest. Hit it and you'll start earning on {currentBalance}." }
            ],
            GHOST: [
                { icon: 'üëã', text: "It's not too late! Start with just {minimum} this month. By December, that becomes real money plus interest." },
                { icon: '‚è∞', text: "Every month you wait costs you growth. Deposit {minimum} now and December you will thank today you." },
                { icon: 'üí™', text: "No judgment, just math: {minimum}/month for {monthsLeft} months = {lateStartProjection} by December. Still worth it!" },
                { icon: 'üéØ', text: "Your seat is still warm! Deposit {minimum} this month. Even starting late, you'll have {lateStartProjection} by year-end." },
                { icon: '‚ú®', text: "The best time to start was January. The second best time is today. {minimum} gets you in the game." }
            ],
            EARLY_BIRD: [
                { icon: 'üê¶', text: "Early bird gets the interest! Your deposit is earning more than late-month deposits. December: **{projected}**!" },
                { icon: '‚è∞', text: "Perfect timing! You're earning more interest than average just by depositing early. That's free money for good habits." },
                { icon: 'üéØ', text: "Nailed it! Early deposits mean more earning days. On track for **{projected}** by December." },
                { icon: 'üíé', text: "Premium timing! You're maximizing interest by depositing early. December you: **{projected}**." },
            ],
            BIG_DEPOSITOR: [
                { icon: 'üêã', text: "Whale alert! Your {currentBalance} is the group's backbone. Projected {projected} by December." },
                { icon: 'üëë', text: "Your {avgDeposit}/month is above average. December you: {projected}. Respect!" },
                { icon: 'üåü', text: "Star power! Your {totalTopups} in contributions are setting the pace. Projected {projected} by December." },
            ],
            ACCELERATOR: [
                { icon: 'üöÄ', text: "Momentum builder! From {previousMonthTopup} to {currentMonthTopup} this month. Keep this and you'll blow past {projected}!" },
                { icon: 'üìà', text: "You're scaling up! Deposits growing {percentIncrease}% month-over-month. December could surprise with {stretchGoal}." },
                { icon: 'üî•', text: "On fire! Contributions jumped from {previousMonthTopup} to {currentMonthTopup}. Hit {stretchGoal} by year-end." },
            ],
            STEADY_CONTRIBUTOR: [
                { icon: 'üéØ', text: "Consistency wins! You've hit {avgDeposit} like clockwork. December: {projected}." },
                { icon: '‚öôÔ∏è', text: "Autopilot mode. Your steady {avgDeposit}/month is compounding nicely. By December: {projected}+." },
                { icon: 'üèÜ', text: "Steady wins the race. {avgDeposit} deposits earning you {projected} by year-end." }
            ],
            DECELERATOR: [
                { icon: '‚ö†Ô∏è', text: "Heads up! You dropped from {previousMonthTopup} to {currentMonthTopup} this month. Try to get back on track." },
                { icon: 'üí°', text: "Your balance is still growing, but slower. Bump back to {suggestedNextDeposit}/month to hit {projected}." },
                { icon: 'üõ§Ô∏è', text: "You're slipping a bit. Get back to {minimum}+ and December you hits {projected}." }
            ],
            VOLATILE: [
                { icon: 'üé¢', text: "Rollercoaster rider! Try smoothing to {avgDeposit} consistently for better growth to {projected}." },
                { icon: 'üé≤', text: "Wildcard! Aim for {minimum}+ steadily to maximize compound interest." },
            ]
        };

        function getAuthToken() {
            try {
                const raw = localStorage.getItem('mmf_auth');
                if (!raw) return null;
                const token = JSON.parse(raw);
                if (new Date().getTime() > token.expiresAt) { localStorage.removeItem('mmf_auth'); return null; }
                return token;
            } catch(e) { localStorage.removeItem('mmf_auth'); return null; }
        }

        function setAuthToken() {
            localStorage.setItem('mmf_auth', JSON.stringify({
                authenticated: true,

const INSPIRATIONS = [
    "Small, consistent steps build extraordinary wealth. Keep going.",
    "Every contribution today is a gift to your future self.",
    "Saving together multiplies what we could never do alone.",
    "The best time to save was yesterday. The next best time is now.",
    "Discipline today. Freedom tomorrow. You're on the right path.",
    "Wealth isn't built in a day ‚Äî it's built every single day.",
    "Your commitment to this group is an investment in yourself.",
    "Consistency is the most underrated financial strategy. You have it.",
];

function getGreeting() {
    const h = new Date().getHours();
    if (h < 12) return 'Good morning,';
    if (h < 17) return 'Good afternoon,';
    return 'Good evening,';
}

function getInspiration() {
    return INSPIRATIONS[Math.floor(Date.now() / (1000*60*60*3)) % INSPIRATIONS.length];
}

function getCurrentMonth() { return MONTHS[new Date().getMonth()]; }

function getAuthToken() {
    try {
        const raw = localStorage.getItem('mmf_auth');
        if (!raw) return null;
        const t = JSON.parse(raw);
        if (Date.now() > t.expiresAt) { localStorage.removeItem('mmf_auth'); return null; }
        return t;
    } catch(e) { localStorage.removeItem('mmf_auth'); return null; }
}

function setAuthToken() {
    localStorage.setItem('mmf_auth', JSON.stringify({
        authenticated: true,
        expiresAt: Date.now() + (AUTH_EXPIRY_DAYS * 86400000)
    }));
}

function parseCSVLine(line) {
    const r = []; let cur = '', inQ = false;
    for (const ch of line) {
        if (ch === '"') inQ = !inQ;
        else if (ch === ',' && !inQ) { r.push(cur); cur = ''; }
        else cur += ch;
    }
    r.push(cur); return r;
}


        function calculateMemberArchetype(memberData, allMembersData, currentMonth) {
            const { totalTopups, currentMonthTopup, closingBalance, daysActive, previousMonthTopup } = memberData;
            const monthIndex = MONTHS.indexOf(currentMonth);
            const monthsElapsed = monthIndex + 1;
            const sortedMembers = [...allMembersData].sort((a,b) => b.closingBalance - a.closingBalance);
            const rank = sortedMembers.findIndex(m => m.closingBalance === closingBalance) + 1;
            if (totalTopups === 0) return 'GHOST';
            if (currentMonthTopup > 0 && currentMonthTopup < MINIMUM_CONTRIBUTION) return 'PARTIAL_CONTRIBUTOR';
            if (monthIndex > 0 && previousMonthTopup !== undefined) {
                const trendChange  = currentMonthTopup - previousMonthTopup;
                const trendPercent = previousMonthTopup > 0 ? (trendChange / previousMonthTopup) * 100 : 0;
                if (Math.abs(trendPercent) > 50 && monthIndex > 1) return 'VOLATILE';
                if (trendChange > 0 && trendPercent > 20) return 'ACCELERATOR';
                if (trendChange < 0 && trendPercent < -20 && currentMonthTopup >= MINIMUM_CONTRIBUTION) return 'DECELERATOR';
            }
            const avgDeposit = monthsElapsed > 0 ? totalTopups / monthsElapsed : 0;
            if (rank <= 3 && closingBalance > 0) return 'OVERACHIEVER';
            if (daysActive <= 5 && currentMonthTopup >= MINIMUM_CONTRIBUTION) return 'EARLY_BIRD';
            if (avgDeposit > MINIMUM_CONTRIBUTION * 2) return 'BIG_DEPOSITOR';
            if (currentMonthTopup >= MINIMUM_CONTRIBUTION) {
                const variance = Math.abs(currentMonthTopup - avgDeposit) / (avgDeposit || 1);
                return variance < 0.15 ? 'STEADY_CONTRIBUTOR' : 'STEADY_CLIMBER';
            }
            return 'STEADY_CLIMBER';
        }


        function formatArchetypeMessage(archetype, memberData, allMembersData, currentMonth) {
            try {
                const messages = ARCHETYPE_MESSAGES[archetype] || ARCHETYPE_MESSAGES.STEADY_CLIMBER;
                let available = messages;
                const monthIndex = MONTHS.indexOf(currentMonth);
                if (monthIndex === 0) {
                    const trendTypes = ['LATE_BLOOMER','ACCELERATOR','DECELERATOR','VOLATILE'];
                    if (trendTypes.includes(archetype)) {
                        available = messages.filter(m => !m.text.includes('{previousMonthTopup}') && !m.text.includes('{previousInterest}'));
                        if (!available.length) available = ARCHETYPE_MESSAGES.STEADY_CLIMBER;
                    }
                }
                const msg = available[Math.floor(Math.random() * available.length)];
                const monthsElapsed   = monthIndex + 1;
                const monthsRemaining = 12 - monthsElapsed;
                const avgDeposit      = monthsElapsed > 0 ? (memberData.totalTopups || 0) / monthsElapsed : 0;
                const projected       = (memberData.closingBalance || 0) + (avgDeposit * monthsRemaining);
                const stretchGoal     = (memberData.closingBalance || 0) + ((avgDeposit * 1.5) * monthsRemaining);
                const suggestedNext   = Math.round((memberData.currentMonthTopup || 0) * 1.2);
                const prevTopup       = memberData.previousMonthTopup || 0;
                const balanceIncrease = prevTopup > 0 ? Math.round(((memberData.currentMonthTopup - prevTopup) / prevTopup) * 100) : 0;
                const estimatedInterest = ((memberData.closingBalance||0) + (avgDeposit*monthsRemaining)) * ETICA_MONTHLY_YIELD * monthsRemaining;
                const shareOfTotal    = allMembersData.length > 0 ? Math.round(((memberData.closingBalance||0) / allMembersData.reduce((s,m)=>s+(m.closingBalance||0),0))*100) : 0;
                const lateStart       = MINIMUM_CONTRIBUTION * monthsRemaining + (MINIMUM_CONTRIBUTION * monthsRemaining * ETICA_MONTHLY_YIELD * (monthsRemaining/2));
                let text = msg.text
                    .replace(/{projected}/g,           `KES ${Math.round(projected).toLocaleString()}`)
                    .replace(/{stretchGoal}/g,         `KES ${Math.round(stretchGoal).toLocaleString()}`)
                    .replace(/{totalTopups}/g,         `KES ${(memberData.totalTopups||0).toLocaleString()}`)
                    .replace(/{currentMonthTopup}/g,   `KES ${(memberData.currentMonthTopup||0).toLocaleString()}`)
                    .replace(/{previousMonthTopup}/g,  `KES ${prevTopup.toLocaleString()}`)
                    .replace(/{interest}/g,            `KES ${(memberData.totalInterest||0).toLocaleString()}`)
                    .replace(/{currentInterest}/g,     `KES ${(memberData.currentInterest||0).toLocaleString()}`)
                    .replace(/{avgDeposit}/g,          `KES ${Math.round(avgDeposit).toLocaleString()}`)
                    .replace(/{monthsLeft}/g,          monthsRemaining.toString())
                    .replace(/{minimum}/g,             `KES ${MINIMUM_CONTRIBUTION.toLocaleString()}`)
                    .replace(/{gapToMinimum}/g,        `KES ${Math.max(0, MINIMUM_CONTRIBUTION-(memberData.currentMonthTopup||0)).toLocaleString()}`)
                    .replace(/{currentBalance}/g,      `KES ${(memberData.closingBalance||0).toLocaleString()}`)
                    .replace(/{suggestedNextDeposit}/g,`KES ${suggestedNext.toLocaleString()}`)
                    .replace(/{balanceIncrease}/g,     balanceIncrease.toString())
                    .replace(/{percentIncrease}/g,     balanceIncrease.toString())
                    .replace(/{similarMembers}/g,      (Math.floor(Math.random()*5)+3).toString())
                    .replace(/{shareOfTotal}/g,        shareOfTotal.toString())
                    .replace(/{projectedInterest}/g,   `KES ${Math.round(estimatedInterest).toLocaleString()}`)
                    .replace(/{lateStartProjection}/g, `KES ${Math.round(lateStart).toLocaleString()}`)
                    .replace(/\*\*/g, '');
                return { icon: msg.icon, text };
            } catch(e) {
                return { icon: 'üìä', text: `You're on track for KES ${Math.round((memberData.closingBalance||0)+40000).toLocaleString()} by December. Keep going!` };
            }
        }


/* PASSWORD SCREEN */
function PasswordScreen({onSuccess}) {
    const [pw, setPw]     = useState('');
    const [err, setErr]   = useState('');
    const [shake, setShake] = useState(false);
    const submit = e => {
        e.preventDefault();
        if (pw === CORRECT_PASSWORD) { setAuthToken(); onSuccess(); }
        else {
            setErr('Incorrect password. Contact your group admin.');
            setShake(true); setTimeout(() => setShake(false), 500); setPw('');
        }
    };
    return (
        <div className="pw-screen">
            <div className="pw-card" style={{animation:shake?'shake .5s,fadeUp .4s ease':'fadeUp .4s ease'}}>
                <div className="pw-lock">üîí</div>
                <div className="pw-title">Like-Minded Folks</div>
                <div className="pw-sub">MMF Account Tracker ¬∑ Members Only</div>
                <form onSubmit={submit} style={{width:'100%',display:'flex',flexDirection:'column',gap:8}}>
                    <input type="password" value={pw} onChange={e=>setPw(e.target.value)}
                        placeholder="Enter password" autoFocus
                        className={`pw-input${err?' err':''}`} />
                    <div className="pw-err">{err}</div>
                    <button type="submit" className="pw-btn">Access Tracker ‚Üí</button>
                </form>
                <div className="pw-help">Don't have the password?<br/>Contact your group admin</div>
            </div>
        </div>
    );
}

/* MEMBER PROJECTION CHART */
function MemberProjectionChart({selectedAlias, data, currentMonth}) {
    const chartRef = useRef(null), instRef = useRef(null);
    useEffect(() => {
        if (!chartRef.current || !data || !selectedAlias) return;
        if (instRef.current) instRef.current.destroy();
        const ctx = chartRef.current.getContext('2d');
        const idx = MONTHS.indexOf(currentMonth);
        const labels = MONTHS.map(m => m.slice(0,3));
        let totalTopups = 0;
        const actualDeps = [], actualBals = [];
        for (let i = 0; i <= idx; i++) {
            const md = data[MONTHS[i]]?.[selectedAlias] || {};
            actualDeps.push(md.topups || 0);
            actualBals.push(md.closingBalance || 0);
            totalTopups += md.topups || 0;
        }
        const avg = (idx+1) > 0 ? totalTopups / (idx+1) : MINIMUM_CONTRIBUTION;
        const barData   = [...actualDeps, ...Array(11-idx).fill(null)];
        const barColors = actualDeps.map(v => v >= MINIMUM_CONTRIBUTION ? 'rgba(0,200,122,.78)' : v > 0 ? 'rgba(245,158,11,.78)' : 'rgba(239,68,68,.55)').concat(Array(11-idx).fill('transparent'));
        const balLine   = [...actualBals, ...Array(11-idx).fill(null)];
        const lastBal   = actualBals[actualBals.length-1] || 0;
        const projLine  = Array(12).fill(null); projLine[idx] = lastBal;
        for (let i = idx+1; i < 12; i++) projLine[i] = (projLine[i-1] + avg) * (1 + ETICA_MONTHLY_YIELD);
        instRef.current = new Chart(ctx, {
            data: { labels, datasets: [
                {type:'bar',label:'Monthly Deposit',data:barData,backgroundColor:barColors,borderWidth:0,borderRadius:4,yAxisID:'y',order:3},
                {type:'line',label:'Balance to Date',data:balLine,borderColor:'#00c87a',backgroundColor:'transparent',borderWidth:2.5,pointBackgroundColor:'#00c87a',pointRadius:4,fill:false,tension:.3,yAxisID:'y',order:1,spanGaps:false},
                {type:'line',label:'Projected',data:projLine,borderColor:'#3b82f6',backgroundColor:'transparent',borderWidth:2,borderDash:[6,4],pointBackgroundColor:'#3b82f6',pointRadius:3,fill:false,tension:.3,yAxisID:'y',order:2,spanGaps:false}
            ]},
            options: {responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},
                plugins:{legend:{display:true,position:'top',labels:{color:'rgba(200,200,220,.5)',font:{size:10,family:'DM Sans'},boxWidth:10,padding:12}},
                    tooltip:{backgroundColor:'#1e2232',titleColor:'#00c87a',bodyColor:'#eef0f8',borderColor:'rgba(0,200,122,.2)',borderWidth:1,
                        callbacks:{label:c=>{const v=c.parsed.y;if(v===null||v===undefined)return null;return `${c.dataset.label}: KES ${Math.round(v).toLocaleString()}`;}}} },
                scales:{y:{beginAtZero:true,ticks:{color:'rgba(200,200,220,.35)',font:{size:9},callback:v=>'KES '+(v/1000).toFixed(0)+'k'},grid:{color:'rgba(255,255,255,.04)'}},
                    x:{ticks:{color:'rgba(200,200,220,.35)',font:{size:9}},grid:{display:false}}}
            }
        });
        return () => { if (instRef.current) instRef.current.destroy(); };
    }, [selectedAlias, data, currentMonth]);
    if (!selectedAlias) return null;
    return <div style={{height:'240px',position:'relative'}}><canvas ref={chartRef}/></div>;
}

/* GROUP BALANCE CHART */
function GroupBalanceChart({data, currentMonth}) {
    const chartRef = useRef(null), instRef = useRef(null);
    useEffect(() => {
        if (!chartRef.current || !data) return;
        if (instRef.current) instRef.current.destroy();
        const ctx = chartRef.current.getContext('2d');
        const idx = MONTHS.indexOf(currentMonth);
        const labels = MONTHS.map(m => m.slice(0,3));
        let totalAll = 0;
        const monthlyTotals = [], actualBals = [];
        for (let i = 0; i <= idx; i++) {
            let t = 0, b = 0;
            MEMBERS.forEach(a => { t += data[MONTHS[i]]?.[a]?.topups || 0; b += data[MONTHS[i]]?.[a]?.closingBalance || 0; });
            monthlyTotals.push(t); actualBals.push(b); totalAll += t;
        }
        const avgM = (idx+1) > 0 ? totalAll/(idx+1) : 0;
        const barData = [...monthlyTotals, ...Array(11-idx).fill(null)];
        const lastBal = actualBals[actualBals.length-1] || 0;
        const projLine = Array(12).fill(null); projLine[idx] = lastBal;
        for (let i = idx+1; i < 12; i++) projLine[i] = (projLine[i-1] + avgM) * (1 + ETICA_MONTHLY_YIELD);
        instRef.current = new Chart(ctx, {
            data: { labels, datasets: [
                {type:'bar',label:'Monthly Group Total',data:barData,backgroundColor:'rgba(0,200,122,.65)',borderWidth:0,borderRadius:4,yAxisID:'y',order:2},
                {type:'line',label:'Projected Balance',data:projLine,borderColor:'#3b82f6',backgroundColor:'transparent',borderWidth:2,borderDash:[6,4],pointBackgroundColor:'#3b82f6',pointRadius:3,fill:false,tension:.3,yAxisID:'y',order:1,spanGaps:false}
            ]},
            options: {responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},
                plugins:{legend:{display:true,position:'top',labels:{color:'rgba(200,200,220,.5)',font:{size:10,family:'DM Sans'},boxWidth:10,padding:12}},
                    tooltip:{backgroundColor:'#1e2232',titleColor:'#00c87a',bodyColor:'#eef0f8',borderColor:'rgba(0,200,122,.2)',borderWidth:1,
                        callbacks:{label:c=>{const v=c.parsed.y;if(v===null||v===undefined)return null;return `${c.dataset.label}: KES ${Math.round(v).toLocaleString()}`;}}} },
                scales:{y:{beginAtZero:true,ticks:{color:'rgba(200,200,220,.35)',font:{size:9},callback:v=>'KES '+(v/1000).toFixed(0)+'k'},grid:{color:'rgba(255,255,255,.04)'}},
                    x:{ticks:{color:'rgba(200,200,220,.35)',font:{size:9}},grid:{display:false}}}
            }
        });
        return () => { if (instRef.current) instRef.current.destroy(); };
    }, [data, currentMonth]);
    return <div style={{height:'220px',position:'relative'}}><canvas ref={chartRef}/></div>;
}

/* ALL MEMBERS VIEW */
function AllMembersView({month, members, fileLastModified, data, onBack}) {
    const tOp = members.reduce((s,m)=>s+m.openingBalance,0);
    const tTu = members.reduce((s,m)=>s+m.topups,0);
    const tIn = members.reduce((s,m)=>s+m.interest,0);
    const tCl = members.reduce((s,m)=>s+m.closingBalance,0);
    return (
        <div className="inner-view">
            <button className="inner-back" onClick={onBack}>‚Üê Back to Overview</button>
            <div className="inner-title">Group Saving &amp; Interest ¬∑ {month}</div>
            <div className="chart-card">
                <div className="chart-label">Group Monthly Totals &amp; Projection</div>
                <div className="chart-sub">
                    <span style={{color:'#00c87a'}}>‚ñä</span> Monthly totals &nbsp;¬∑&nbsp;
                    <span style={{color:'#3b82f6'}}>‚ïå‚ïå</span> Projected to December
                </div>
                <GroupBalanceChart data={data} currentMonth={month} />
            </div>
            <div className="members-table-wrap">
                <table className="members-table">
                    <thead>
                        <tr>
                            <th style={{textAlign:'left',width:'28px'}}>#</th>
                            <th style={{textAlign:'left'}}>Alias</th>
                            <th className="num-col">Opening</th>
                            <th className="num-col">Top-ups</th>
                            <th className="num-col">{month.slice(0,3)} Int.</th>
                            <th className="num-col">Balance</th>
                        </tr>
                    </thead>
                    <tbody>
                        {members.map((m,i) => {
                            const dot = m.topups>=MINIMUM_CONTRIBUTION?'#00c87a':m.topups>0?'#f59e0b':'#ef4444';
                            const rnk = i+1;
                            return (
                                <tr key={m.alias}>
                                    <td>{rnk<=3?['ü•á','ü•à','ü•â'][rnk-1]:rnk}</td>
                                    <td style={{textAlign:'left',fontWeight:600,color:'var(--t1)'}}> {m.alias}</td>
                                    <td className="num-col">{m.openingBalance.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                                    <td className="num-col">
                                        <div className="topup-cell">
                                            {m.topups.toLocaleString('en-KE',{maximumFractionDigits:0})}
                                            <span className="status-dot" style={{backgroundColor:dot}} />
                                        </div>
                                    </td>
                                    <td className="num-col">{m.interest.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                                    <td className="num-col closing-col">{m.closingBalance.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                                </tr>
                            );
                        })}
                        <tr className="total-row">
                            <td/><td>TOTALS</td>
                            <td className="num-col">{tOp.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                            <td className="num-col">{tTu.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                            <td className="num-col">{tIn.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                            <td className="num-col closing-col">{tCl.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            {fileLastModified && (
                <div className="data-ts">
                    Data as of {fileLastModified.toLocaleString('en-KE',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit',hour12:true})}
                </div>
            )}
        </div>
    );
}

/* MAIN APP */
function App() {
    const [auth, setAuth]                     = useState(() => !!getAuthToken());
    const [theme, setTheme]                   = useState(() => localStorage.getItem('mmf_theme') || 'dark');
    const [data, setData]                     = useState(null);
    const [loading, setLoading]               = useState(true);
    const [error, setError]                   = useState(null);
    const [tab, setTab]                       = useState('overview');
    const [selectedMonth, setSelectedMonth]   = useState(getCurrentMonth());
    const [selectedAlias, setSelectedAlias]   = useState('');
    const [showAllMembers, setShowAllMembers] = useState(false);
    const [fileLastModified, setFileLM]       = useState(null);

    useEffect(() => {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('mmf_theme', theme);
    }, [theme]);

    useEffect(() => { if (auth) loadData(); }, [auth]);

    const loadData = async () => {
        try {
            setLoading(true); setError(null);
            const parsed = {};
            const results = await Promise.all(MONTHS.map(async month => {
                const url  = MONTH_CSV_URLS[month];
                const resp = await fetch(`${url}&_=${Date.now()}`, {cache:'no-store'});
                if (!resp.ok) throw new Error(`Could not load ${month}`);
                const text  = await resp.text();
                const lines = text.split('\n').filter(l => l.trim());
                const md = {};
                for (let i = 3; i < lines.length; i++) {
                    const cols  = parseCSVLine(lines[i]);
                    const alias = cols[0]?.trim().replace(/"/g,'');
                    if (alias && MEMBERS.includes(alias)) {
                        const n = s => parseFloat((s||'').replace(/["',\s]/g,'')) || 0;
                        md[alias] = {
                            openingBalance: n(cols[1]), topups: n(cols[2]),
                            interest: n(cols[3]),
                            daysActive: parseInt((cols[4]||'').replace(/[",\s]/g,'')) || 0,
                            closingBalance: n(cols[5])
                        };
                    }
                }
                return {month, monthData: md};
            }));
            results.forEach(({month, monthData}) => { parsed[month] = monthData; });
            setData(parsed); setFileLM(new Date()); setLoading(false);
        } catch(err) {
            setError('Unable to load data from Google Sheets. Please refresh or contact the admin.');
            setLoading(false);
        }
    };

    const getAllMembersData = useCallback((month) => {
        if (!data) return [];
        return MEMBERS.map(alias => ({
            alias, ...(data[month]?.[alias] || {openingBalance:0,topups:0,interest:0,daysActive:0,closingBalance:0})
        })).sort((a,b) => b.closingBalance - a.closingBalance);
    }, [data]);

    const groupStats = useCallback(() => {
        if (!data) return null;
        const members    = getAllMembersData(selectedMonth);
        const monthTopups   = members.reduce((s,m) => s+m.topups, 0);
        const monthInterest = members.reduce((s,m) => s+m.interest, 0);
        const totalBalance  = members.reduce((s,m) => s+m.closingBalance, 0);
        const idx = MONTHS.indexOf(selectedMonth);
        let cumContrib = 0, cumInterest = 0;
        for (let i = 0; i <= idx; i++) {
            if (data[MONTHS[i]]) {
                const mm = getAllMembersData(MONTHS[i]);
                cumContrib  += mm.reduce((s,m) => s+m.topups, 0);
                cumInterest += mm.reduce((s,m) => s+m.interest, 0);
            }
        }
        return {monthTopups, monthInterest, cumContrib, cumInterest, totalBalance};
    }, [data, selectedMonth, getAllMembersData]);

    if (!auth) return <PasswordScreen onSuccess={() => setAuth(true)} />;

    if (loading) return (
        <div className="loading-screen">
            <div className="loader"/>
            <div>Loading your data‚Ä¶</div>
        </div>
    );

    if (error) return (
        <div className="loading-screen">
            <div style={{fontSize:'1.5rem'}}>‚ö†Ô∏è</div>
            <div style={{color:'var(--red)',textAlign:'center',padding:'0 32px'}}> {error}</div>
            <button onClick={loadData} className="pw-btn" style={{width:'auto',padding:'10px 24px',marginTop:8}}>Retry</button>
        </div>
    );

    const stats         = groupStats();
    const curMonth      = getCurrentMonth();
    const isCurrentMonth = m => m === curMonth;
    const showWarnings   = () => new Date().getDate() >= WARNING_START_DAY;

    /* My Balance statement data */
    const md      = data?.[selectedMonth]?.[selectedAlias] || {openingBalance:0,topups:0,interest:0,daysActive:0,closingBalance:0};
    const partner = MEMBER_PAIRS[selectedAlias];
    let showWarning = false, warningMsg = '';
    if (isCurrentMonth(selectedMonth) && showWarnings() && selectedAlias) {
        if (partner) {
            const pd = data[selectedMonth]?.[partner] || {topups:0};
            const combined = md.topups + pd.topups;
            if (combined > 0 && combined < MINIMUM_CONTRIBUTION) {
                showWarning = true;
                const fn = PARTIAL_CONTRIBUTION_MESSAGES[Math.floor(Math.random()*PARTIAL_CONTRIBUTION_MESSAGES.length)];
                warningMsg = fn(combined, MINIMUM_CONTRIBUTION-combined) + ` (Combined with ${partner})`;
            } else if (combined === 0) {
                showWarning = true;
                warningMsg = `Your combined ${selectedMonth} contribution with ${partner} hasn't been recorded yet. Please coordinate to deposit KES ${MINIMUM_CONTRIBUTION.toLocaleString()} soon.`;
            }
        } else {
            if (md.topups > 0 && md.topups < MINIMUM_CONTRIBUTION) {
                showWarning = true;
                const fn = PARTIAL_CONTRIBUTION_MESSAGES[Math.floor(Math.random()*PARTIAL_CONTRIBUTION_MESSAGES.length)];
                warningMsg = fn(md.topups, MINIMUM_CONTRIBUTION-md.topups);
            } else if (md.topups === 0) {
                showWarning = true;
                warningMsg = `Your ${selectedMonth} contribution hasn't been recorded yet. Please deposit at least KES ${MINIMUM_CONTRIBUTION.toLocaleString()} soon.`;
            }
        }
    }

    /* Motivation card */
    let motivation = {icon:'üìä', text:'Keep going!'};
    if (selectedAlias && data) {
        const idx = MONTHS.indexOf(selectedMonth);
        const hist = {totalTopups:0,totalInterest:0,currentMonthTopup:0,currentInterest:0,previousMonthTopup:0,closingBalance:0,daysActive:0};
        for (let i = 0; i <= idx; i++) {
            const m2 = data[MONTHS[i]]?.[selectedAlias] || {};
            hist.totalTopups   += m2.topups   || 0;
            hist.totalInterest += m2.interest || 0;
            if (i === idx)   { hist.currentMonthTopup = m2.topups||0; hist.currentInterest = m2.interest||0; hist.closingBalance = m2.closingBalance||0; hist.daysActive = m2.daysActive||0; }
            if (i === idx-1) { hist.previousMonthTopup = m2.topups||0; }
        }
        const allMD = MEMBERS.map(a => ({alias:a, closingBalance:data[selectedMonth]?.[a]?.closingBalance||0}));
        const arch  = calculateMemberArchetype(hist, allMD, selectedMonth);
        motivation  = formatArchetypeMessage(arch, hist, allMD, selectedMonth);
    }

    /* View Contributions opener */
    const openContributions = () => {
        const b64 = 'PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCwgbWF4aW11bS1zY2FsZT0xLjAsIHVzZXItc2NhbGFibGU9bm8iPgogICAgPHRpdGxlPkxNRiBDb250cmlidXRpb24vRGVwb3NpdCBUcmFja2VyPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICAqIHsKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgIH0KICAgICAgICAKICAgICAgICBib2R5IHsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IC1hcHBsZS1zeXN0ZW0sIEJsaW5rTWFjU3lzdGVtRm9udCwgJ1NlZ29lIFVJJywgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuMzsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZmZjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgI2xvYWRpbmcgewogICAgICAgICAgICBwYWRkaW5nOiAyMHB4OwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIGNvbG9yOiAjNjY2OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAjZXJyb3IgewogICAgICAgICAgICBwYWRkaW5nOiAyMHB4OwogICAgICAgICAgICBjb2xvcjogI2QzMmYyZjsKICAgICAgICAgICAgZGlzcGxheTogbm9uZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLnRhYmxlLWNvbnRhaW5lciB7CiAgICAgICAgICAgIHdpZHRoOiAxMDB2dzsKICAgICAgICAgICAgaGVpZ2h0OiAxMDB2aDsKICAgICAgICAgICAgb3ZlcmZsb3c6IGF1dG87CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRhYmxlIHsKICAgICAgICAgICAgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsKICAgICAgICAgICAgd2lkdGg6IG1heC1jb250ZW50OwogICAgICAgICAgICBmb250LXNpemU6IDExcHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRoLCB0ZCB7CiAgICAgICAgICAgIHBhZGRpbmc6IDRweCAzcHg7CiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgYm9yZGVyOiAwLjVweCBzb2xpZCAjZDBkMGQwOwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwogICAgICAgICAgICBmb250LXNpemU6IDExcHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIEluY3JlYXNlIGZvbnQgc2l6ZSBmb3IgZGF0YSByb3dzICh0Ym9keSkgKi8KICAgICAgICB0Ym9keSB0ZCB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTNweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogRmlyc3QgdGhyZWUgY29sdW1ucyAtIGZyb3plbiBhbmQgY29tcGFjdCAqLwogICAgICAgIHRoOm50aC1jaGlsZCgxKSwKICAgICAgICB0ZDpudGgtY2hpbGQoMSkgewogICAgICAgICAgICBwb3NpdGlvbjogc3RpY2t5OwogICAgICAgICAgICBsZWZ0OiAwOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmFmYWZhOwogICAgICAgICAgICB6LWluZGV4OiA1OwogICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0OwogICAgICAgICAgICB3aWR0aDogYXV0bzsKICAgICAgICAgICAgbWluLXdpZHRoOiAzMHB4OwogICAgICAgICAgICBtYXgtd2lkdGg6IDV2dzsKICAgICAgICAgICAgZm9udC1zaXplOiAxMXB4OwogICAgICAgICAgICBwYWRkaW5nOiA0cHggM3B4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKiBJbmNyZWFzZSBmb250IHNpemUgZm9yIHRib2R5IGNlbGxzIGluIGNvbHVtbiAxICovCiAgICAgICAgdGJvZHkgdGQ6bnRoLWNoaWxkKDEpIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxM3B4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICB0aDpudGgtY2hpbGQoMiksCiAgICAgICAgdGQ6bnRoLWNoaWxkKDIpIHsKICAgICAgICAgICAgcG9zaXRpb246IHN0aWNreTsKICAgICAgICAgICAgbGVmdDogdmFyKC0tY29sMS13aWR0aCwgNXZ3KTsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZhZmFmYTsKICAgICAgICAgICAgei1pbmRleDogNTsKICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsKICAgICAgICAgICAgd2lkdGg6IGF1dG87CiAgICAgICAgICAgIG1pbi13aWR0aDogODBweDsKICAgICAgICAgICAgbWF4LXdpZHRoOiAxNnZ3OwogICAgICAgICAgICBmb250LXNpemU6IDExcHg7CiAgICAgICAgICAgIHBhZGRpbmc6IDRweCAzcHg7CiAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3JtYWw7CiAgICAgICAgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsKICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuMzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogSW5jcmVhc2UgZm9udCBzaXplIGZvciB0Ym9keSBjZWxscyBpbiBjb2x1bW4gMiAqLwogICAgICAgIHRib2R5IHRkOm50aC1jaGlsZCgyKSB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTNweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdGg6bnRoLWNoaWxkKDMpLAogICAgICAgIHRkOm50aC1jaGlsZCgzKSB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBzdGlja3k7CiAgICAgICAgICAgIGxlZnQ6IHZhcigtLWNvbDItd2lkdGgsIDIxdncpOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmFmYWZhOwogICAgICAgICAgICB6LWluZGV4OiA1OwogICAgICAgICAgICB0ZXh0LWFsaWduOiByaWdodDsKICAgICAgICAgICAgd2lkdGg6IGF1dG87CiAgICAgICAgICAgIG1pbi13aWR0aDogODBweDsKICAgICAgICAgICAgbWF4LXdpZHRoOiBjYWxjKDMzLjMzdncgLSB2YXIoLS1jb2wxLXdpZHRoLCA1dncpIC0gdmFyKC0tY29sMi13aWR0aCwgMjF2dykgKyA1dncgKyAxNnZ3KTsKICAgICAgICAgICAgZm9udC1zaXplOiAxMXB4OwogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDNweDsKICAgICAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIEluY3JlYXNlIGZvbnQgc2l6ZSBmb3IgdGJvZHkgY2VsbHMgaW4gY29sdW1uIDMgKi8KICAgICAgICB0Ym9keSB0ZDpudGgtY2hpbGQoMykgewogICAgICAgICAgICBmb250LXNpemU6IDEzcHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIEhlYWRlciByb3dzIHN0aWNreSAqLwogICAgICAgIHRoZWFkIHRyIHRoIHsKICAgICAgICAgICAgcG9zaXRpb246IHN0aWNreTsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2Y1ZjVmNTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICAgICAgei1pbmRleDogMTA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIEZpcnN0IHRocmVlIGNvbHVtbiBoZWFkZXJzIGhpZ2hlciB6LWluZGV4ICovCiAgICAgICAgdGhlYWQgdHIgdGg6bnRoLWNoaWxkKDEpLAogICAgICAgIHRoZWFkIHRyIHRoOm50aC1jaGlsZCgyKSwKICAgICAgICB0aGVhZCB0ciB0aDpudGgtY2hpbGQoMykgewogICAgICAgICAgICB6LWluZGV4OiAxNTsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZhZmFmYTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogUm93IDEgLSBXZWVrIG51bWJlcnMgKi8KICAgICAgICB0aGVhZCB0cjpudGgtY2hpbGQoMSkgdGggewogICAgICAgICAgICB0b3A6IDA7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTBweDsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDNweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogUm93IDIgLSBNb250aHMgKG1lcmdlZCBjZWxscykgKi8KICAgICAgICB0aGVhZCB0cjpudGgtY2hpbGQoMikgdGggewogICAgICAgICAgICB0b3A6IDI0cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTBweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDNweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogUm93IDMgLSBEYXRlcyB3aXRoIHdyYXBwaW5nICovCiAgICAgICAgdGhlYWQgdHI6bnRoLWNoaWxkKDMpIHRoIHsKICAgICAgICAgICAgdG9wOiA0OHB4OwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogbm9ybWFsOwogICAgICAgICAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTBweDsKICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuMjsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDJweDsKICAgICAgICAgICAgaGVpZ2h0OiAzNnB4OwogICAgICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjMDA0MjNlICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogRGF0ZSByb3cgLSBmaXJzdCB0aHJlZSBjb2x1bW5zIGFsc28gZ2V0IHRoZSBjb2xvciAqLwogICAgICAgIHRoZWFkIHRyOm50aC1jaGlsZCgzKSB0aDpudGgtY2hpbGQoMSksCiAgICAgICAgdGhlYWQgdHI6bnRoLWNoaWxkKDMpIHRoOm50aC1jaGlsZCgyKSwKICAgICAgICB0aGVhZCB0cjpudGgtY2hpbGQoMykgdGg6bnRoLWNoaWxkKDMpIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogIzAwNDIzZSAhaW1wb3J0YW50OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKiBCYW5kZWQgcm93cyAtIGFsdGVybmF0aW5nIGNvbG9ycyAqLwogICAgICAgIHRib2R5IHRyOm50aC1jaGlsZChldmVuKSB0ZCB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNkY2U2ZjE7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRib2R5IHRyOm50aC1jaGlsZChvZGQpIHRkIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZjlmOTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogQXBwbHkgYmFuZGVkIGNvbG9ycyB0byBmcm96ZW4gY29sdW1ucyB0b28gKi8KICAgICAgICB0Ym9keSB0cjpudGgtY2hpbGQoZXZlbikgdGQ6bnRoLWNoaWxkKDEpLAogICAgICAgIHRib2R5IHRyOm50aC1jaGlsZChldmVuKSB0ZDpudGgtY2hpbGQoMiksCiAgICAgICAgdGJvZHkgdHI6bnRoLWNoaWxkKGV2ZW4pIHRkOm50aC1jaGlsZCgzKSB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNkY2U2ZjE7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRib2R5IHRyOm50aC1jaGlsZChvZGQpIHRkOm50aC1jaGlsZCgxKSwKICAgICAgICB0Ym9keSB0cjpudGgtY2hpbGQob2RkKSB0ZDpudGgtY2hpbGQoMiksCiAgICAgICAgdGJvZHkgdHI6bnRoLWNoaWxkKG9kZCkgdGQ6bnRoLWNoaWxkKDMpIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZjlmOTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogTnVtYmVyIGFsaWdubWVudCBhbmQgZm9ybWF0dGluZyAqLwogICAgICAgIHRkLm51bWJlciB7CiAgICAgICAgICAgIHRleHQtYWxpZ246IHJpZ2h0OwogICAgICAgICAgICBmb250LXZhcmlhbnQtbnVtZXJpYzogdGFidWxhci1udW1zOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKiBUT1RBTCByb3cgc3R5bGluZyAqLwogICAgICAgIHRib2R5IHRyLnRvdGFsLXJvdyB0ZCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICMwMDIzNTEgIWltcG9ydGFudDsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvKiBDb21wYWN0IGRhdGEgY29sdW1ucyAqLwogICAgICAgIHRoOm5vdCg6bnRoLWNoaWxkKDEpKTpub3QoOm50aC1jaGlsZCgyKSk6bm90KDpudGgtY2hpbGQoMykpLAogICAgICAgIHRkOm5vdCg6bnRoLWNoaWxkKDEpKTpub3QoOm50aC1jaGlsZCgyKSk6bm90KDpudGgtY2hpbGQoMykpIHsKICAgICAgICAgICAgbWluLXdpZHRoOiA1MHB4OwogICAgICAgICAgICBtYXgtd2lkdGg6IDY1cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTFweDsKICAgICAgICAgICAgcGFkZGluZzogNHB4IDNweDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogSW5jcmVhc2UgZm9udCBzaXplIGZvciB0Ym9keSBkYXRhIGNlbGxzICovCiAgICAgICAgdGJvZHkgdGQ6bm90KDpudGgtY2hpbGQoMSkpOm5vdCg6bnRoLWNoaWxkKDIpKTpub3QoOm50aC1jaGlsZCgzKSkgewogICAgICAgICAgICBmb250LXNpemU6IDEzcHg7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIExvYWRpbmcgc3Bpbm5lciAqLwogICAgICAgIC5zcGlubmVyIHsKICAgICAgICAgICAgYm9yZGVyOiAzcHggc29saWQgI2YzZjNmMzsKICAgICAgICAgICAgYm9yZGVyLXRvcDogM3B4IHNvbGlkICMzNDk4ZGI7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgICAgICAgICAgd2lkdGg6IDMwcHg7CiAgICAgICAgICAgIGhlaWdodDogMzBweDsKICAgICAgICAgICAgYW5pbWF0aW9uOiBzcGluIDFzIGxpbmVhciBpbmZpbml0ZTsKICAgICAgICAgICAgbWFyZ2luOiAyMHB4IGF1dG87CiAgICAgICAgfQogICAgICAgIAogICAgICAgIEBrZXlmcmFtZXMgc3BpbiB7CiAgICAgICAgICAgIDAlIHsgdHJhbnNmb3JtOiByb3RhdGUoMGRlZyk7IH0KICAgICAgICAgICAgMTAwJSB7IHRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7IH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogSGVhZGVyIHRpdGxlICovCiAgICAgICAgLnBhZ2UtaGVhZGVyIHsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICBwYWRkaW5nOiAxNXB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjMDA0MjNlOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMThweDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgICAgICAgIHBvc2l0aW9uOiBzdGlja3k7CiAgICAgICAgICAgIHRvcDogMDsKICAgICAgICAgICAgei1pbmRleDogMjA7CiAgICAgICAgfQogICAgPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KICAgIDxkaXYgY2xhc3M9InBhZ2UtaGVhZGVyIj5MTUYgQ29udHJpYnV0aW9uL0RlcG9zaXQgVHJhY2tlcjwvZGl2PgogICAgPGRpdiBpZD0ibG9hZGluZyI+CiAgICAgICAgPGRpdiBjbGFzcz0ic3Bpbm5lciI+PC9kaXY+CiAgICAgICAgPHA+TG9hZGluZyBkYXRhLi4uPC9wPgogICAgPC9kaXY+CiAgICA8ZGl2IGlkPSJlcnJvciI+PC9kaXY+CiAgICA8ZGl2IGlkPSJ0YWJsZUNvbnRhaW5lciIgY2xhc3M9InRhYmxlLWNvbnRhaW5lciIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij48L2Rpdj4KCiAgICA8c2NyaXB0PgogICAgICAgIGNvbnN0IENTVl9VUkwgPSAnaHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlFmUWRCVmwwMWN4c0lvR25mSkxsdEdEdU9rSVZERnFqLXJOZzNLd0ZWWjgtR0diVXFrMURTc19DVmF5Z2lzamFMaGczMGcxZ2p6SXNkQy9wdWI/Z2lkPTIwNzk0NTMwMTYmc2luZ2xlPXRydWUmb3V0cHV0PWNzdic7CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gcGFyc2VDU1YodGV4dCkgewogICAgICAgICAgICBjb25zdCBsaW5lcyA9IFtdOwogICAgICAgICAgICBsZXQgY3VycmVudExpbmUgPSBbXTsKICAgICAgICAgICAgbGV0IGN1cnJlbnRGaWVsZCA9ICcnOwogICAgICAgICAgICBsZXQgaW5RdW90ZXMgPSBmYWxzZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGV4dC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgY2hhciA9IHRleHRbaV07CiAgICAgICAgICAgICAgICBjb25zdCBuZXh0Q2hhciA9IHRleHRbaSArIDFdOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoY2hhciA9PT0gJyInKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluUXVvdGVzICYmIG5leHRDaGFyID09PSAnIicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEZpZWxkICs9ICciJzsKICAgICAgICAgICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGluUXVvdGVzID0gIWluUXVvdGVzOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciA9PT0gJywnICYmICFpblF1b3RlcykgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lLnB1c2goY3VycmVudEZpZWxkKTsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50RmllbGQgPSAnJzsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKGNoYXIgPT09ICdcbicgfHwgY2hhciA9PT0gJ1xyJykgJiYgIWluUXVvdGVzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRGaWVsZCB8fCBjdXJyZW50TGluZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lLnB1c2goY3VycmVudEZpZWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGluZXMucHVzaChjdXJyZW50TGluZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRGaWVsZCA9ICcnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoY2hhciA9PT0gJ1xyJyAmJiBuZXh0Q2hhciA9PT0gJ1xuJykgewogICAgICAgICAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50RmllbGQgKz0gY2hhcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGN1cnJlbnRGaWVsZCB8fCBjdXJyZW50TGluZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50TGluZS5wdXNoKGN1cnJlbnRGaWVsZCk7CiAgICAgICAgICAgICAgICBsaW5lcy5wdXNoKGN1cnJlbnRMaW5lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGxpbmVzOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBpc051bWVyaWModmFsdWUpIHsKICAgICAgICAgICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZS50cmltKCkgPT09ICcnKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IG51bSA9IHZhbHVlLnJlcGxhY2UoLywvZywgJycpOwogICAgICAgICAgICByZXR1cm4gIWlzTmFOKG51bSkgJiYgIWlzTmFOKHBhcnNlRmxvYXQobnVtKSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGZvcm1hdE51bWJlcih2YWx1ZSkgewogICAgICAgICAgICBjb25zdCBudW0gPSBwYXJzZUZsb2F0KHZhbHVlLnJlcGxhY2UoLywvZywgJycpKTsKICAgICAgICAgICAgaWYgKGlzTmFOKG51bSkpIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobnVtKS50b0xvY2FsZVN0cmluZygnZW4tVVMnKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVGFibGUoZGF0YSkgewogICAgICAgICAgICBpZiAoIWRhdGEgfHwgZGF0YS5sZW5ndGggPCA1KSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBlbm91Z2ggZGF0YSBmb3VuZCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTa2lwIGZpcnN0IDQgcm93cwogICAgICAgICAgICAvLyBSb3cgNSAoaW5kZXggNCkgPSBXZWVrIG51bWJlcnMKICAgICAgICAgICAgLy8gUm93IDYgKGluZGV4IDUpID0gTW9udGhzCiAgICAgICAgICAgIC8vIFJvdyA3IChpbmRleCA2KSA9IERhdGVzCiAgICAgICAgICAgIGNvbnN0IHdlZWtSb3cgPSBkYXRhWzRdOwogICAgICAgICAgICBjb25zdCBtb250aFJvdyA9IGRhdGFbNV07CiAgICAgICAgICAgIGNvbnN0IGRhdGVSb3cgPSBkYXRhWzZdOwogICAgICAgICAgICBjb25zdCBkYXRhUm93cyA9IGRhdGEuc2xpY2UoNykuZmlsdGVyKHJvdyA9PiByb3cuc29tZShjZWxsID0+IGNlbGwgJiYgY2VsbC50cmltKCkpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKTsKICAgICAgICAgICAgY29uc3QgdGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aGVhZCcpOwogICAgICAgICAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3Rib2R5Jyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDcmVhdGUgd2VlayBudW1iZXIgcm93CiAgICAgICAgICAgIGNvbnN0IHdlZWtUciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICAgICAgICAgIC8vIEFkZCBibGFuayBjZWxscyBmb3IgZmlyc3QgdGhyZWUgY29sdW1ucwogICAgICAgICAgICBjb25zdCBibGFua1dlZWsxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTsKICAgICAgICAgICAgY29uc3QgYmxhbmtXZWVrMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7CiAgICAgICAgICAgIGNvbnN0IGJsYW5rV2VlazMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpOwogICAgICAgICAgICBibGFua1dlZWszLnRleHRDb250ZW50ID0gJ1dFRUsgTk8uJzsKICAgICAgICAgICAgYmxhbmtXZWVrMy5zdHlsZS5jb2xvciA9ICdibGFjayc7CiAgICAgICAgICAgIGJsYW5rV2VlazMuc3R5bGUuZm9udFdlaWdodCA9ICdib2xkJzsKICAgICAgICAgICAgd2Vla1RyLmFwcGVuZENoaWxkKGJsYW5rV2VlazEpOwogICAgICAgICAgICB3ZWVrVHIuYXBwZW5kQ2hpbGQoYmxhbmtXZWVrMik7CiAgICAgICAgICAgIHdlZWtUci5hcHBlbmRDaGlsZChibGFua1dlZWszKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAzOyBpIDwgd2Vla1Jvdy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpOwogICAgICAgICAgICAgICAgdGgudGV4dENvbnRlbnQgPSB3ZWVrUm93W2ldIHx8ICcnOwogICAgICAgICAgICAgICAgd2Vla1RyLmFwcGVuZENoaWxkKHRoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGVhZC5hcHBlbmRDaGlsZCh3ZWVrVHIpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ3JlYXRlIG1vbnRoIHJvdyB3aXRoIG1lcmdlZCBjZWxscwogICAgICAgICAgICBjb25zdCBtb250aFRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKICAgICAgICAgICAgLy8gQWRkIGJsYW5rIGNlbGxzIGZvciBmaXJzdCB0aHJlZSBjb2x1bW5zCiAgICAgICAgICAgIGNvbnN0IGJsYW5rTW9udGgxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTsKICAgICAgICAgICAgY29uc3QgYmxhbmtNb250aDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpOwogICAgICAgICAgICBjb25zdCBibGFua01vbnRoMyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7CiAgICAgICAgICAgIGJsYW5rTW9udGgzLnRleHRDb250ZW50ID0gJ01PTlRIJzsKICAgICAgICAgICAgYmxhbmtNb250aDMuc3R5bGUuY29sb3IgPSAnYmxhY2snOwogICAgICAgICAgICBibGFua01vbnRoMy5zdHlsZS5mb250V2VpZ2h0ID0gJ2JvbGQnOwogICAgICAgICAgICBtb250aFRyLmFwcGVuZENoaWxkKGJsYW5rTW9udGgxKTsKICAgICAgICAgICAgbW9udGhUci5hcHBlbmRDaGlsZChibGFua01vbnRoMik7CiAgICAgICAgICAgIG1vbnRoVHIuYXBwZW5kQ2hpbGQoYmxhbmtNb250aDMpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVHJhY2sgbWVyZ2VkIG1vbnRoIGNlbGxzCiAgICAgICAgICAgIGxldCBpID0gMzsKICAgICAgICAgICAgd2hpbGUgKGkgPCBtb250aFJvdy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG1vbnRoVmFsdWUgPSBtb250aFJvd1tpXSB8fCAnJzsKICAgICAgICAgICAgICAgIGxldCBjb2xzcGFuID0gMTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ291bnQgY29uc2VjdXRpdmUgY2VsbHMgd2l0aCBzYW1lIG1vbnRoCiAgICAgICAgICAgICAgICB3aGlsZSAoaSArIGNvbHNwYW4gPCBtb250aFJvdy5sZW5ndGggJiYgbW9udGhSb3dbaSArIGNvbHNwYW5dID09PSBtb250aFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgY29sc3BhbisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCB0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7CiAgICAgICAgICAgICAgICB0aC50ZXh0Q29udGVudCA9IG1vbnRoVmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoY29sc3BhbiA+IDEpIHsKICAgICAgICAgICAgICAgICAgICB0aC5zZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nLCBjb2xzcGFuKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1vbnRoVHIuYXBwZW5kQ2hpbGQodGgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpICs9IGNvbHNwYW47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhlYWQuYXBwZW5kQ2hpbGQobW9udGhUcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDcmVhdGUgZGF0ZSByb3cKICAgICAgICAgICAgY29uc3QgZGF0ZVRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKICAgICAgICAgICAgLy8gQWRkIGJsYW5rIGNlbGxzIGZvciBmaXJzdCB0aHJlZSBjb2x1bW5zCiAgICAgICAgICAgIGNvbnN0IGJsYW5rRGF0ZTEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpOwogICAgICAgICAgICBjb25zdCBibGFua0RhdGUyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTsKICAgICAgICAgICAgY29uc3QgYmxhbmtEYXRlMyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7CiAgICAgICAgICAgIGJsYW5rRGF0ZTMudGV4dENvbnRlbnQgPSAnVE9UQUwnOwogICAgICAgICAgICBibGFua0RhdGUzLnN0eWxlLmNvbG9yID0gJ3doaXRlJzsKICAgICAgICAgICAgYmxhbmtEYXRlMy5zdHlsZS5mb250V2VpZ2h0ID0gJ2JvbGQnOwogICAgICAgICAgICBkYXRlVHIuYXBwZW5kQ2hpbGQoYmxhbmtEYXRlMSk7CiAgICAgICAgICAgIGRhdGVUci5hcHBlbmRDaGlsZChibGFua0RhdGUyKTsKICAgICAgICAgICAgZGF0ZVRyLmFwcGVuZENoaWxkKGJsYW5rRGF0ZTMpOwogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDM7IGkgPCBkYXRlUm93Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7CiAgICAgICAgICAgICAgICB0aC50ZXh0Q29udGVudCA9IGRhdGVSb3dbaV0gfHwgJyc7CiAgICAgICAgICAgICAgICBkYXRlVHIuYXBwZW5kQ2hpbGQodGgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoZWFkLmFwcGVuZENoaWxkKGRhdGVUcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDcmVhdGUgZGF0YSByb3dzCiAgICAgICAgICAgIGRhdGFSb3dzLmZvckVhY2gocm93ID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIFRPVEFMIHJvdyAobG9vayBmb3IgIlRPVEFMIiBpbiBmaXJzdCBvciBzZWNvbmQgY29sdW1uKQogICAgICAgICAgICAgICAgY29uc3QgaXNUb3RhbCA9IChyb3dbMF0gJiYgcm93WzBdLnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoJ1RPVEFMJykpIHx8IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJvd1sxXSAmJiByb3dbMV0udG9VcHBlckNhc2UoKS5pbmNsdWRlcygnVE9UQUwnKSk7CiAgICAgICAgICAgICAgICBpZiAoaXNUb3RhbCkgewogICAgICAgICAgICAgICAgICAgIHRyLmNsYXNzTGlzdC5hZGQoJ3RvdGFsLXJvdycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE1hdGgubWF4KHJvdy5sZW5ndGgsIHdlZWtSb3cubGVuZ3RoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IHJvd1tpXSB8fCAnJzsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBDb2x1bW4gMSAtIHRleHQgb25seQogICAgICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRkLnRleHRDb250ZW50ID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgICAgICAvLyBDb2x1bW4gMiAtIHRleHQgd2l0aCB3cmFwcGluZyBhZnRlciAiLyIKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5pbmNsdWRlcygnLycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoJy8nLCAnL1xuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGQudGV4dENvbnRlbnQgPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGQuc3R5bGUud2hpdGVTcGFjZSA9ICdwcmUtbGluZSc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIENvbHVtbiAzIC0gbnVtYmVycyB3aXRoIGNvbW1hcywgbm8gZGVjaW1hbHMsIGJvbGQsIHJpZ2h0LWFsaWduZWQKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc051bWVyaWModmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZC50ZXh0Q29udGVudCA9IGZvcm1hdE51bWJlcih2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZC50ZXh0Q29udGVudCA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJpZ2h0LWFsaWduZWQgYW5kIGJvbGQgKGFscmVhZHkgc3R5bGVkIGluIENTUykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXIgY29sdW1ucyAtIGNoZWNrIGlmIG51bWVyaWMKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTnVtZXJpYyh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRkLnRleHRDb250ZW50ID0gZm9ybWF0TnVtYmVyKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRkLmNsYXNzTGlzdC5hZGQoJ251bWJlcicpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGQudGV4dENvbnRlbnQgPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB0ci5hcHBlbmRDaGlsZCh0ZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0Ym9keS5hcHBlbmRDaGlsZCh0cik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgdGFibGUuYXBwZW5kQ2hpbGQodGhlYWQpOwogICAgICAgICAgICB0YWJsZS5hcHBlbmRDaGlsZCh0Ym9keSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFibGVDb250YWluZXInKTsKICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGFibGUpOwogICAgICAgICAgICBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBkeW5hbWljIHdpZHRocyBmb3IgZmlyc3QgdGhyZWUgY29sdW1ucwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbDFDZWxscyA9IHRhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkOm50aC1jaGlsZCgxKSwgdGg6bnRoLWNoaWxkKDEpJyk7CiAgICAgICAgICAgICAgICBjb25zdCBjb2wyQ2VsbHMgPSB0YWJsZS5xdWVyeVNlbGVjdG9yQWxsKCd0ZDpudGgtY2hpbGQoMiksIHRoOm50aC1jaGlsZCgyKScpOwogICAgICAgICAgICAgICAgY29uc3QgY29sM0NlbGxzID0gdGFibGUucXVlcnlTZWxlY3RvckFsbCgndGQ6bnRoLWNoaWxkKDMpLCB0aDpudGgtY2hpbGQoMyknKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IG1heENvbDEgPSAwOwogICAgICAgICAgICAgICAgbGV0IG1heENvbDIgPSAwOwogICAgICAgICAgICAgICAgbGV0IG1heENvbDMgPSAwOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb2wxQ2VsbHMuZm9yRWFjaChjZWxsID0+IG1heENvbDEgPSBNYXRoLm1heChtYXhDb2wxLCBjZWxsLnNjcm9sbFdpZHRoKSk7CiAgICAgICAgICAgICAgICBjb2wyQ2VsbHMuZm9yRWFjaChjZWxsID0+IG1heENvbDIgPSBNYXRoLm1heChtYXhDb2wyLCBjZWxsLnNjcm9sbFdpZHRoKSk7CiAgICAgICAgICAgICAgICBjb2wzQ2VsbHMuZm9yRWFjaChjZWxsID0+IG1heENvbDMgPSBNYXRoLm1heChtYXhDb2wzLCBjZWxsLnNjcm9sbFdpZHRoKSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEFkZCBzb21lIHBhZGRpbmcKICAgICAgICAgICAgICAgIG1heENvbDEgKz0gODsKICAgICAgICAgICAgICAgIG1heENvbDIgKz0gODsKICAgICAgICAgICAgICAgIG1heENvbDMgKz0gODsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRW5zdXJlIHRvdGFsIGRvZXNuJ3QgZXhjZWVkIDMzLjMzdncKICAgICAgICAgICAgICAgIGNvbnN0IG1heFRvdGFsID0gd2luZG93LmlubmVyV2lkdGggKiAwLjMzMzM7CiAgICAgICAgICAgICAgICBjb25zdCB0b3RhbCA9IG1heENvbDEgKyBtYXhDb2wyICsgbWF4Q29sMzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRvdGFsID4gbWF4VG90YWwpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzY2FsZSA9IG1heFRvdGFsIC8gdG90YWw7CiAgICAgICAgICAgICAgICAgICAgbWF4Q29sMSAqPSBzY2FsZTsKICAgICAgICAgICAgICAgICAgICBtYXhDb2wyICo9IHNjYWxlOwogICAgICAgICAgICAgICAgICAgIG1heENvbDMgKj0gc2NhbGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgd2lkdGhzCiAgICAgICAgICAgICAgICBjb2wxQ2VsbHMuZm9yRWFjaChjZWxsID0+IGNlbGwuc3R5bGUud2lkdGggPSBtYXhDb2wxICsgJ3B4Jyk7CiAgICAgICAgICAgICAgICBjb2wyQ2VsbHMuZm9yRWFjaChjZWxsID0+IHsKICAgICAgICAgICAgICAgICAgICBjZWxsLnN0eWxlLndpZHRoID0gbWF4Q29sMiArICdweCc7CiAgICAgICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5sZWZ0ID0gbWF4Q29sMSArICdweCc7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGNvbDNDZWxscy5mb3JFYWNoKGNlbGwgPT4gewogICAgICAgICAgICAgICAgICAgIGNlbGwuc3R5bGUud2lkdGggPSBtYXhDb2wzICsgJ3B4JzsKICAgICAgICAgICAgICAgICAgICBjZWxsLnN0eWxlLmxlZnQgPSAobWF4Q29sMSArIG1heENvbDIpICsgJ3B4JzsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LCAxMDApOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBhc3luYyBmdW5jdGlvbiBsb2FkRGF0YSgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goQ1NWX1VSTCk7CiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2g6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcGFyc2VDU1YodGV4dCk7CiAgICAgICAgICAgICAgICBjcmVhdGVUYWJsZShkYXRhKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgZGF0YTonLCBlcnJvcik7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBjb25zdCBlcnJvckRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcnJvcicpOwogICAgICAgICAgICAgICAgZXJyb3JEaXYudGV4dENvbnRlbnQgPSBgRXJyb3IgbG9hZGluZyBkYXRhOiAke2Vycm9yLm1lc3NhZ2V9LiBQdWxsIGRvd24gdG8gcmVmcmVzaC5gOwogICAgICAgICAgICAgICAgZXJyb3JEaXYuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gTG9hZCBkYXRhIG9uIHBhZ2UgbG9hZAogICAgICAgIGxvYWREYXRhKCk7CiAgICA8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==';
        const bytes = atob(b64); const arr = new Uint8Array(bytes.length);
        for (let i=0;i<bytes.length;i++) arr[i] = bytes.charCodeAt(i);
        const blob = new Blob([arr], {type:'text/html'});
        window.open(URL.createObjectURL(blob), '_blank');
    };

    return (
        <div className="app-shell">

            {/* HEADER */}
            <div className="app-header">
                <div className="app-header-top">
                    <div>
                        <div className="app-eyebrow">¬∑ MMF Account Tracker ¬∑ {CURRENT_YEAR}</div>
                        <div className="app-title">Like-Minded Folks</div>
                        <div className="app-subtitle">Track contributions, interest &amp; projections</div>
                    </div>
                    <button className="theme-toggle" onClick={() => setTheme(t => t==='dark'?'light':'dark')} aria-label="Toggle theme">
                        <div className="theme-knob">{theme==='dark'?'‚òÄÔ∏è':'üåô'}</div>
                    </button>
                </div>
            </div>

            {/* GREETING */}
            <div className="greeting">
                <div className="greeting-time">{getGreeting()}</div>
                <div className="greeting-inspo">{getInspiration()}</div>
            </div>

            {/* TAB NAV */}
            <div className="tab-nav">
                {[['overview','Overview'],['balance','My Balance'],['more','More+']].map(([id,label]) => (
                    <button key={id} className={`tab-btn${tab===id?' active':''}`}
                        onClick={() => { setTab(id); setShowAllMembers(false); }}>
                        {label}
                    </button>
                ))}
            </div>

            {/* ‚ïê‚ïê TAB 1: OVERVIEW ‚ïê‚ïê */}
            <div className={`tab-panel${tab==='overview'?' active':''}`}>
                {showAllMembers ? (
                    <AllMembersView
                        month={selectedMonth}
                        members={getAllMembersData(selectedMonth)}
                        fileLastModified={fileLastModified}
                        data={data}
                        onBack={() => setShowAllMembers(false)}
                    />
                ) : (
                    <>
                        <div className="overview-hero">
                            <div className="hero-label">Group Contributions to Date ¬∑ Jan ‚Äì {selectedMonth}</div>
                            <div className="hero-amount">
                                {stats ? stats.cumContrib.toLocaleString('en-KE',{maximumFractionDigits:0}) : '‚Äî'}
                            </div>
                            <div className="hero-sub">
                                <span style={{color:'var(--t3)'}}>This month:</span>
                                <span className="hero-pill">
                                    ‚Üë KES {stats ? stats.monthTopups.toLocaleString('en-KE',{maximumFractionDigits:0}) : '0'}
                                </span>
                            </div>
                        </div>

                        <div className="blob-zone">
                            <div className="blob-extra"/>
                            <div className="stack-cards">
                                <div className="stack-card stack-card-1" onClick={openContributions}>
                                    <div className="stack-card-icon">üõ°</div>
                                    <div className="stack-card-label">Group Contributions</div>
                                    <div className="stack-card-arrow">‚Üó</div>
                                </div>
                                <div className="stack-card stack-card-2" onClick={() => setShowAllMembers(true)}>
                                    <div className="stack-card-icon">‚áå</div>
                                    <div className="stack-card-label">Group Saving &amp; Interest</div>
                                    <div className="stack-card-arrow">‚Üí</div>
                                </div>
                                <div className="stack-card stack-card-3" style={{flexDirection:'column',alignItems:'flex-start',gap:0,padding:0}}>
                                    <div style={{display:'flex',alignItems:'center',gap:14,padding:'20px 22px 10px'}}>
                                        <div className="stack-card-icon" style={{background:'rgba(10,42,34,.15)'}}>‚ü≥</div>
                                        <div className="stack-card-label">Group Balance</div>
                                    </div>
                                    <div className="card3-stats">
                                        <div className="card3-row">
                                            <div className="card3-num">
                                                {stats ? stats.cumInterest.toLocaleString('en-KE',{minimumFractionDigits:2,maximumFractionDigits:2}) : '‚Äî'}
                                            </div>
                                            <div className="card3-lbl">Current Interest<br/>Earned</div>
                                        </div>
                                        <div className="card3-row">
                                            <div className="card3-num card3-big">
                                                {stats ? stats.totalBalance.toLocaleString('en-KE',{minimumFractionDigits:2,maximumFractionDigits:2}) : '‚Äî'}
                                            </div>
                                            <div className="card3-lbl">Total Group<br/>Balance</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="privacy-notice">
                            üîê <strong>Members only.</strong> Keep this page confidential. Do not share links or screenshots outside LMF.
                        </div>
                    </>
                )}
            </div>

            {/* ‚ïê‚ïê TAB 2: MY BALANCE ‚ïê‚ïê */}
            <div className={`tab-panel${tab==='balance'?' active':''}`}>
                <div className="balance-pad">
                    <div className="month-scroll">
                        {MONTHS.map(m => (
                            <button key={m} className={`month-pill${selectedMonth===m?' active':''}`}
                                onClick={() => setSelectedMonth(m)}>
                                {m.slice(0,3)}
                            </button>
                        ))}
                    </div>

                    <div className="alias-card">
                        <div className="alias-card-label">Who are you?</div>
                        <select className="alias-select" value={selectedAlias}
                            onChange={e => setSelectedAlias(e.target.value)}>
                            <option value="" disabled>Select your alias‚Ä¶</option>
                            {MEMBERS.map(a => <option key={a} value={a}>{a}</option>)}
                        </select>
                    </div>

                    {selectedAlias ? (
                        <>
                            <div className="statement-card">
                                <div className="stmt-alias">{selectedAlias}</div>
                                <div className="stmt-month">{selectedMonth} {CURRENT_YEAR}</div>
                                <div className="stmt-row">
                                    <span className="stmt-label">Opening Balance</span>
                                    <span className="stmt-value">{md.openingBalance.toLocaleString('en-KE',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                                <div className="stmt-row">
                                    <span className="stmt-label">Top-ups</span>
                                    <span className="stmt-value blue">{md.topups.toLocaleString('en-KE',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                                <div className="stmt-row">
                                    <span className="stmt-label">
                                        Interest Earned
                                        <div className="early-hint">Early deposits earn more</div>
                                    </span>
                                    <span className="stmt-value grn">{md.interest.toLocaleString('en-KE',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                                <div className="stmt-row">
                                    <span className="stmt-label stmt-label-hero">Current Balance</span>
                                    <span className="stmt-value hero">{md.closingBalance.toLocaleString('en-KE',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                                {fileLastModified && (
                                    <div className="stmt-ts">
                                        Data as of {fileLastModified.toLocaleString('en-KE',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit',hour12:true})}
                                    </div>
                                )}
                            </div>

                            {showWarning && (
                                <div className="warning-card">
                                    <div className="warning-icon">‚ö†Ô∏è</div>
                                    <div>
                                        <div className="warning-title">Friendly Reminder</div>
                                        <div className="warning-body">{warningMsg}</div>
                                    </div>
                                </div>
                            )}

                            <div className="chart-card">
                                <div className="chart-label">Contributions &amp; Balance Growth</div>
                                <div className="chart-sub">
                                    <span style={{color:'#00c87a'}}>‚ñä</span> Monthly top-ups &nbsp;
                                    <span style={{color:'#00c87a'}}>‚Äî‚Äî</span> Balance &nbsp;
                                    <span style={{color:'#3b82f6'}}>‚ïå‚ïå</span> Projected to Dec
                                </div>
                                <MemberProjectionChart selectedAlias={selectedAlias} data={data} currentMonth={selectedMonth} />
                            </div>

                            <div className="motivation-card">
                                <div className="motivation-icon">{motivation.icon}</div>
                                <div className="motivation-text">{motivation.text}</div>
                            </div>
                        </>
                    ) : (
                        <div className="empty-state">
                            <div className="empty-icon">üëÜ</div>
                            Select your alias above to see your personal balance and projection
                        </div>
                    )}
                </div>
            </div>

            {/* ‚ïê‚ïê TAB 3: MORE+ ‚ïê‚ïê */}
            <div className={`tab-panel${tab==='more'?' active':''}`}>
                <div className="more-pad">

                    <div className="more-card">
                        <div className="more-card-head">üí≥ Make a Deposit</div>
                        <div className="more-card-body">
                            <div className="deposit-method">
                                <div className="dep-title">M-PESA</div>
                                <div className="dep-info">
                                    Paybill: <strong>4096483</strong><br/>
                                    Account: <strong>308398M</strong>
                                </div>
                            </div>
                            <div className="deposit-method">
                                <div className="dep-title">Bank Deposit / Transfer</div>
                                <div className="dep-info">
                                    Bank: <strong>Equity Bank</strong><br/>
                                    A/C Name: Etica Unit Trust Collection<br/>
                                    A/C No: <strong>0180 28395 1027</strong><br/>
                                    Reference: <strong>308398M</strong>
                                </div>
                                <div className="dep-warn">
                                    ‚ö†Ô∏è <strong>Important:</strong> Always write <strong>308398M</strong> in the Reference / Remarks field.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="more-card">
                        <div className="more-card-head">üìú Group Rules</div>
                        <div className="more-card-body">
                            <ul className="rules-list">
                                <li>Minimum contribution: <strong>KES 4,000/month</strong></li>
                                <li>Interest only on months with the full minimum contribution</li>
                                <li>Withdrawals: December (before Week 3)</li>
                                <li>Fund: <strong>Etica MMF</strong> ‚Äî 12% APY (1% monthly)</li>
                                <li>Maximum members: <strong>15</strong></li>
                            </ul>
                        </div>
                    </div>

                    <div className="more-card">
                        <div className="more-card-head">üìÑ Etica Monthly Statements</div>
                        <div className="more-card-body">
                            <div className="pdf-pw">Password: 308398</div>
                            <select className="stmt-select" onChange={e => {
                                if (!e.target.value) return;
                                const month = e.target.value;
                                const msgs = [
                                    `üìä The ${month} statement is still being prepared. Check back soon!`,
                                    `‚è≥ ${month} numbers are being finalised. Almost ready!`,
                                    `üìù Our team is finalising ${month}. Patience pays!`,
                                ];
                                alert(msgs[Math.floor(Math.random()*msgs.length)]);
                                e.target.value = '';
                            }}>
                                <option value="">üì• Select Month to Download</option>
                                {MONTHS.map(m => <option key={m} value={m}>{m}</option>)}
                            </select>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    );
}

ReactDOM.render(<App/>, document.getElementById('root'));
</script>
</body>
</html>