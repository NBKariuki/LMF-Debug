<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Like-Minded Folks - MMF Tracker</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%230d0d14%22/><text x=%2250%22 y=%2268%22 font-family=%22Arial,sans-serif%22 font-size=%2248%22 font-weight=%22700%22 fill=%22%2300e5a0%22 text-anchor=%22middle%22>L</text></svg>">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Sora:wght@400;600;700;800&family=JetBrains+Mono:wght@500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg:       #090912;
            --surface:  #0f0f1c;
            --card:     #131320;
            --elevated: #1a1a2e;
            --border:   rgba(255,255,255,0.08);
            --border-g: rgba(0,229,160,0.28);
            --accent:   #00e5a0;
            --accent-d: rgba(0,229,160,0.14);
            --blue:     #60a5fa;
            --blue-d:   rgba(96,165,250,0.14);
            --gold:     #f59e0b;
            --gold-d:   rgba(245,158,11,0.15);
            --red:      #f87171;
            --red-d:    rgba(248,113,113,0.12);
            --green:    #34d399;
            --t1:       #f0f0f8;
            --t2:       rgba(240,240,248,0.60);
            --t3:       rgba(240,240,248,0.35);
            --r-sm: 8px; --r-md: 12px; --r-lg: 18px; --r-xl: 24px;
        }

        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            font-family: 'Space Grotesk', -apple-system, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--t1);
            background-image:
                radial-gradient(ellipse 80% 40% at 20% 0%, rgba(0,229,160,0.05) 0%, transparent 60%),
                radial-gradient(ellipse 60% 30% at 80% 100%, rgba(96,165,250,0.04) 0%, transparent 60%);
        }

        /* â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .app-layout {
            display: flex;
            max-width: 1360px;
            margin: 0 auto;
            min-height: 100vh;
        }

        /* â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .sidebar {
            width: 256px;
            flex-shrink: 0;
            background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 24px 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 4px;
        }
        .sidebar-logo-icon {
            width: 36px; height: 36px;
            background: linear-gradient(135deg, var(--accent), var(--blue));
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; flex-shrink: 0;
        }
        .sidebar-logo-text { font-family: 'Sora', sans-serif; font-size: 0.9rem; font-weight: 700; line-height: 1.2; }
        .sidebar-logo-sub  { font-size: 0.68rem; color: var(--t3); font-weight: 400; }

        .sidebar-section {
            border: 1px solid var(--border);
            border-radius: var(--r-md);
            padding: 14px;
            margin-bottom: 0;
        }
        .sidebar-section h3 {
            color: var(--t3);
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 0.09em;
            text-transform: uppercase;
            margin-bottom: 10px;
            display: flex; align-items: center; gap: 6px;
        }
        .sidebar-link {
            display: flex; align-items: center; justify-content: center; gap: 8px;
            padding: 10px 14px;
            background: var(--accent-d);
            border: 1px solid var(--border-g);
            border-radius: var(--r-sm);
            color: var(--accent);
            text-decoration: none;
            font-weight: 600; font-size: 0.85rem;
            transition: all 0.2s;
        }
        .sidebar-link:hover { background: rgba(0,229,160,0.22); transform: translateY(-1px); }

        .deposit-method {
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--border);
            border-radius: var(--r-sm);
            padding: 10px; margin-bottom: 8px;
        }
        .deposit-method:last-child { margin-bottom: 0; }
        .deposit-title { color: var(--blue); font-weight: 700; font-size: 0.75rem; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.05em; }
        .deposit-info  { color: var(--t2); font-size: 0.78rem; line-height: 1.65; }
        .deposit-info strong { color: var(--t1); font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; }
        .deposit-warn  { margin-top: 7px; padding: 6px 8px; background: var(--gold-d); border: 1px solid rgba(245,158,11,0.2); border-radius: 6px; font-size: 0.72rem; color: var(--gold); line-height: 1.4; }

        .rules-list { list-style: none; color: var(--t2); font-size: 0.78rem; line-height: 1.7; }
        .rules-list li { display: flex; align-items: flex-start; gap: 6px; padding: 2px 0; }
        .rules-list li::before { content: 'â€“'; color: var(--accent); font-weight: 700; flex-shrink: 0; }
        .rules-list strong { color: var(--t1); }

        .pdf-password { font-size: 0.68rem; font-style: italic; color: var(--gold); text-align: right; margin-bottom: 7px; opacity: 0.85; }
        .statements-dropdown {
            width: 100%; padding: 9px 11px;
            font-size: 0.82rem; font-weight: 600;
            background: var(--accent-d); color: var(--accent);
            border: 1px solid var(--border-g); border-radius: var(--r-sm);
            font-family: 'Space Grotesk', sans-serif; cursor: pointer;
            transition: all 0.2s;
        }
        .statements-dropdown:hover { background: rgba(0,229,160,0.22); }

        .sidebar-close { display: none; text-align: right; margin-bottom: 14px; }
        .sidebar-close button {
            background: var(--red-d); border: 1px solid rgba(248,113,113,0.2);
            color: var(--red); padding: 7px 14px; border-radius: var(--r-sm);
            cursor: pointer; font-weight: 600; font-size: 0.85rem;
            font-family: 'Space Grotesk', sans-serif;
        }

        /* â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .main-content { flex: 1; min-width: 0; padding: 32px 20px; }

        /* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .header { margin-bottom: 32px; }
        .header-eyebrow {
            font-size: 0.68rem; font-weight: 700; letter-spacing: 0.12em;
            text-transform: uppercase; color: var(--accent); margin-bottom: 5px;
            display: flex; align-items: center; gap: 8px;
        }
        .header-eyebrow::before { content:''; display:inline-block; width:18px; height:2px; background:var(--accent); border-radius:2px; }
        .header h1 {
            font-family: 'Sora', sans-serif;
            font-size: clamp(1.5rem, 4vw, 2.3rem);
            font-weight: 800; letter-spacing: -0.02em; line-height: 1.1; margin-bottom: 3px;
        }
        .header-sub { color: var(--t2); font-size: 0.88rem; font-weight: 500; }

        /* â”€â”€ MONTH SELECTOR â€” 2Ã—6 touch grid â”€â”€â”€ */
        .month-selector {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 6px;
            margin-bottom: 28px;
            width: 100%;
        }
        .month-btn {
            padding: 10px 4px;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--t2);
            border-radius: var(--r-md);
            cursor: pointer;
            transition: all 0.18s;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 600; font-size: 0.78rem;
            text-align: center; min-height: 42px;
        }
        .month-btn:hover { color: var(--t1); background: var(--elevated); border-color: rgba(255,255,255,0.13); }
        .month-btn.active {
            background: var(--accent); border-color: var(--accent);
            color: #090912; font-weight: 700;
            box-shadow: 0 2px 14px rgba(0,229,160,0.32);
        }

        /* â”€â”€ VIEW TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .view-toggle { display: flex; gap: 8px; margin-bottom: 32px; }
        .toggle-btn {
            padding: 10px 20px;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--t2); font-weight: 600; font-size: 0.88rem;
            cursor: pointer; border-radius: 30px;
            transition: all 0.2s; font-family: 'Space Grotesk', sans-serif;
        }
        .toggle-btn:hover { border-color: rgba(255,255,255,0.15); color: var(--t1); }
        .toggle-btn.active { background: var(--elevated); border-color: var(--border-g); color: var(--accent); }

        /* â”€â”€ MEMBER VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .member-view { max-width: 580px; margin: 0 auto; }

        .alias-selector { margin-bottom: 40px; }
        .alias-selector select {
            width: 100%; padding: 16px 16px; font-size: 1rem; font-weight: 600;
            background: var(--surface); color: var(--t1);
            border: 1px solid var(--border-g); border-radius: var(--r-md);
            font-family: 'Space Grotesk', sans-serif; cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2300e5a0' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat; background-position: right 16px center;
            padding-right: 42px; transition: all 0.2s;
            animation: selectPulse 2.4s ease-in-out infinite;
        }
        @keyframes selectPulse {
            0%,100% { box-shadow: 0 0 0 0 rgba(0,229,160,0); border-color: rgba(0,229,160,0.28); }
            50%      { box-shadow: 0 0 0 6px rgba(0,229,160,0.12), 0 0 18px rgba(0,229,160,0.18); border-color: rgba(0,229,160,0.7); }
        }
        .alias-selector select:focus {
            outline: none; border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0,229,160,0.15);
            animation: none;
        }
        .alias-selector select option { background: var(--elevated); color: var(--t1); }

        /* â”€â”€ STATEMENT CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .member-statement {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--r-xl);
            padding: 26px;
            margin-bottom: 18px;
            position: relative; overflow: hidden;
        }
        .member-statement::before {
            content:''; position:absolute; top:0; left:0; right:0; height:3px;
            background: linear-gradient(90deg, var(--accent), var(--blue));
        }
        .statement-alias {
            font-family: 'Sora', sans-serif; font-size: 1.7rem; font-weight: 800;
            letter-spacing: -0.02em; margin-bottom: 3px;
            background: linear-gradient(120deg, var(--accent), var(--blue));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .statement-month { color: var(--t3); font-size: 0.82rem; font-weight: 500; margin-bottom: 20px; }
        .statement-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 11px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .statement-row:last-child {
            border-bottom: none; border-top: 1px solid var(--border-g);
            padding-top: 16px; margin-top: 8px;
        }
        .statement-label { font-weight: 500; color: var(--t2); font-size: 0.9rem; }
        .statement-value { font-weight: 700; font-size: 1rem; color: var(--t1); font-family: 'JetBrains Mono', monospace; text-align: right; }
        .statement-value.closing { color: var(--accent); font-size: 1.5rem; }
        .statement-value.blue    { color: var(--blue); }
        .statement-value.green   { color: var(--green); }
        .early-hint { font-size: 0.65rem; font-style: italic; color: var(--gold); margin-top: 2px; opacity: 0.85; }
        .data-timestamp { color: var(--t3); font-size: 0.72rem; margin-top: 14px; text-align: center; }

        /* â”€â”€ PRIVACY NOTICE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .privacy-notice {
            margin-top: 16px;
            padding: 11px 14px;
            background: rgba(96,165,250,0.06);
            border: 1px solid rgba(96,165,250,0.15);
            border-radius: var(--r-md);
            font-size: 0.75rem;
            color: var(--t3);
            line-height: 1.5;
            text-align: center;
        }
        .privacy-notice strong { color: var(--t2); }

        /* â”€â”€ WARNING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .warning-message {
            background: var(--gold-d); border: 1px solid rgba(245,158,11,0.25);
            border-radius: var(--r-md); padding: 13px 15px; margin-bottom: 18px;
            display: flex; align-items: flex-start; gap: 11px;
        }
        .warning-icon { font-size: 1.2rem; flex-shrink: 0; }
        .warning-title { color: var(--gold); font-weight: 700; font-size: 0.78rem; margin-bottom: 3px; text-transform: uppercase; letter-spacing: 0.05em; }
        .warning-content { color: rgba(240,240,248,0.85); font-size: 0.82rem; line-height: 1.5; }

        /* â”€â”€ GROUP SUMMARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .group-summary {
            background: var(--card); border: 1px solid var(--border-g);
            border-radius: var(--r-xl); padding: 20px;
            margin: 48px auto 0; max-width: 600px;
        }
        .group-summary-title {
            font-size: 0.68rem; font-weight: 700; color: var(--t3);
            letter-spacing: 0.1em; text-transform: uppercase;
            margin-bottom: 14px; text-align: center;
        }
        /* ONE ROW, equal-width columns, label top / value bottom */
        .group-summary-grid {
            display: flex; flex-direction: row; gap: 8px;
        }
        .summary-item {
            flex: 1; background: var(--elevated); border: 1px solid var(--border);
            border-radius: var(--r-md); padding: 14px 8px 16px; text-align: center;
            min-width: 0; min-height: 90px;
            display: flex; flex-direction: column;
            justify-content: space-between; align-items: center;
        }
        .summary-label {
            font-size: 0.58rem; color: var(--t3); line-height: 1.25;
            font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em;
            align-self: flex-start; width: 100%;
        }
        .summary-value {
            font-size: 1.05rem; font-weight: 700;
            color: var(--blue); font-family: 'JetBrains Mono', monospace;
            line-height: 1.2; word-break: break-all;
            align-self: flex-end; width: 100; margin-top: 8px;
        }

        /* â”€â”€ CHART CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .chart-card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: var(--r-xl); padding: 20px; margin-bottom: 16px;
        }
        .chart-card-label {
            font-size: 0.68rem; font-weight: 700; color: var(--t3);
            letter-spacing: 0.09em; text-transform: uppercase; margin-bottom: 3px;
        }
        .chart-card-sub { font-size: 0.78rem; color: var(--t2); margin-bottom: 14px; }

        /* â”€â”€ MOTIVATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .motivation-card {
            background: var(--card); border: 1px solid var(--border-g);
            border-radius: var(--r-lg); padding: 16px;
            margin-bottom: 60px;
            display: flex; align-items: flex-start; gap: 13px;
        }
        .motivation-icon { font-size: 1.5rem; line-height: 1; flex-shrink: 0; }
        .motivation-text { font-size: 0.84rem; line-height: 1.6; color: var(--t2); }

        /* â”€â”€ ALL MEMBERS TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .all-members-header {
            display: flex; align-items: center; justify-content: space-between;
            flex-wrap: wrap; gap: 10px; margin-bottom: 16px;
        }
        .all-members-title { font-family: 'Sora', sans-serif; font-size: 1.2rem; font-weight: 700; }

        .search-wrapper { display: flex; align-items: center; gap: 8px; }
        .search-input-wrap { position: relative; }
        .search-input {
            padding: 8px 30px 8px 12px; font-size: 0.82rem;
            border: 1px solid var(--border); border-radius: var(--r-md);
            background: var(--surface); color: var(--t1);
            font-family: 'Space Grotesk', sans-serif; outline: none; width: 180px;
            transition: all 0.2s;
        }
        .search-input:focus { border-color: var(--border-g); width: 220px; }
        .search-input::placeholder { color: var(--t3); }
        .search-clear {
            position: absolute; right: 7px; top: 50%; transform: translateY(-50%);
            background: transparent; border: none; color: var(--t3); cursor: pointer; font-size: 1rem;
        }
        .search-count { font-size: 0.75rem; color: var(--t3); white-space: nowrap; }

        /* TABLE â€” no horizontal scroll, compact columns */
        .members-table-container {
            margin-bottom: 60px;
            border: 1px solid var(--border);
            border-radius: var(--r-lg);
            overflow: hidden;    /* no x-scroll wrapper */
            width: 100%;
        }
        .members-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;  /* fixed layout = no overflow */
        }
        .members-table thead { background: var(--surface); }
        .members-table th {
            padding: 10px 6px;
            font-size: 0.62rem; font-weight: 700; color: var(--t3);
            letter-spacing: 0.07em; text-transform: uppercase;
            border-bottom: 1px solid var(--border);
            white-space: nowrap; overflow: hidden;
        }
        .members-table th:first-child { width: 30px; text-align: center; }
        .members-table th:nth-child(2) { width: 22%; text-align: left; }
        .members-table th:nth-child(3),
        .members-table th:nth-child(4),
        .members-table th:nth-child(5),
        .members-table th:nth-child(6) { text-align: right; }

        .members-table td {
            padding: 10px 6px; font-size: 0.78rem;
            border-bottom: 1px solid rgba(255,255,255,0.04);
            background: var(--card); vertical-align: middle;
            overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
        }
        .members-table tbody tr:hover td { background: rgba(255,255,255,0.03); }
        .members-table tbody tr:last-child td { border-bottom: none; }

        .members-table .rank-col { text-align: center; color: var(--t3); font-size: 0.78rem; }
        .members-table .alias-col { font-weight: 700; color: var(--t1); text-align: left; }
        .members-table .num-col {
            text-align: right;
            font-family: 'JetBrains Mono', monospace; color: var(--t2);
            font-size: 0.75rem;
        }
        .members-table .num-col.closing { color: var(--blue); font-weight: 700; }
        .members-table .total-row td {
            background: rgba(0,229,160,0.05);
            border-top: 1px solid var(--border-g);
            font-weight: 700; color: var(--accent); padding: 12px 6px;
        }

        .topup-cell {
            display: flex; align-items: center;
            justify-content: flex-end; gap: 5px;
        }
        .status-dot {
            display: inline-block; width: 7px; height: 7px;
            border-radius: 50%; flex-shrink: 0; cursor: help;
        }

        /* â”€â”€ LOADING / ERROR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .loading { text-align: center; padding: 80px 20px; }
        .loading-spinner {
            width: 34px; height: 34px;
            border: 3px solid var(--border); border-top-color: var(--accent);
            border-radius: 50%; animation: spin 0.8s linear infinite;
            margin: 0 auto 14px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { color: var(--t2); font-size: 0.9rem; }

        .error {
            background: var(--red-d); border: 1px solid rgba(248,113,113,0.2);
            border-radius: var(--r-lg); padding: 24px; margin: 20px;
            text-align: center; color: var(--red);
        }
        .btn-secondary {
            background: var(--elevated); color: var(--t1);
            border: 1px solid var(--border); padding: 9px 20px;
            font-weight: 600; font-size: 0.85rem; border-radius: var(--r-md);
            cursor: pointer; font-family: 'Space Grotesk', sans-serif;
            margin: 10px 5px 0; transition: all 0.2s;
        }
        .btn-secondary:hover { border-color: var(--border-g); color: var(--accent); }

        /* â”€â”€ MOBILE TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .mobile-menu-toggle {
            display: none; position: fixed; bottom: 22px; right: 22px;
            background: var(--accent); color: #090912;
            border: none; border-radius: 50%; width: 54px; height: 54px;
            font-size: 1.3rem; cursor: pointer;
            box-shadow: 0 4px 24px rgba(0,229,160,0.35); z-index: 1000;
            align-items: center; justify-content: center;
        }

        /* â”€â”€ TOUR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .tour-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.65); z-index: 9998; }
        .tour-highlight {
            position: absolute; border-radius: var(--r-md);
            box-shadow: 0 0 0 3px var(--accent), 0 0 0 9999px rgba(0,0,0,0.6);
            z-index: 9999; pointer-events: none; transition: all 0.35s;
        }
        .tour-tooltip {
            position: absolute; z-index: 10000;
            background: var(--elevated); border: 1px solid var(--border-g);
            border-radius: var(--r-lg); padding: 20px 20px 15px;
            max-width: 280px; width: 90vw; box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        .tour-tooltip-arrow { position: absolute; width: 11px; height: 11px; background: var(--elevated); border-left: 1px solid var(--border-g); border-bottom: 1px solid var(--border-g); }
        .tour-tooltip-arrow.arrow-top    { top: -6px;    left: 28px; transform: rotate(-135deg); }
        .tour-tooltip-arrow.arrow-bottom { bottom: -6px; left: 28px; transform: rotate(45deg);   }
        .tour-step-badge { display: inline-block; background: var(--accent-d); color: var(--accent); border: 1px solid var(--border-g); font-size: 0.62rem; font-weight: 700; padding: 3px 10px; border-radius: 20px; margin-bottom: 9px; letter-spacing: 0.06em; }
        .tour-tooltip h4 { color: var(--t1); font-size: 0.92rem; margin-bottom: 7px; font-weight: 700; }
        .tour-tooltip p  { color: var(--t2); font-size: 0.8rem; line-height: 1.5; }
        .tour-controls   { display: flex; justify-content: space-between; align-items: center; margin-top: 14px; }
        .tour-btn-next   { background: var(--accent); color: #090912; border: none; padding: 7px 17px; border-radius: 20px; font-weight: 700; font-size: 0.8rem; cursor: pointer; font-family: 'Space Grotesk', sans-serif; }
        .tour-btn-skip   { background: none; border: none; color: var(--t3); font-size: 0.75rem; cursor: pointer; font-family: 'Space Grotesk', sans-serif; }
        .tour-btn-skip:hover { color: var(--t2); }
        .tour-dots  { display: flex; gap: 5px; align-items: center; }
        .tour-dot   { width: 6px; height: 6px; border-radius: 50%; background: var(--border); }
        .tour-dot.active { background: var(--accent); }

        /* â”€â”€ PASSWORD SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .password-screen {
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; padding: 20px; background: var(--bg);
            background-image: radial-gradient(ellipse 70% 50% at 50% 0%, rgba(0,229,160,0.07) 0%, transparent 70%);
        }
        .password-card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: var(--r-xl); padding: 44px;
            max-width: 400px; width: 100%; text-align: center;
            position: relative; overflow: hidden;
        }
        .password-card::before { content:''; position:absolute; top:0; left:0; right:0; height:3px; background: linear-gradient(90deg, var(--accent), var(--blue)); }
        .password-title { font-family: 'Sora', sans-serif; font-size: 1.6rem; font-weight: 800; letter-spacing: -0.02em; margin-bottom: 4px; }
        .password-subtitle { color: var(--t3); font-size: 0.82rem; margin-bottom: 30px; }
        .password-lock { font-size: 2.4rem; margin-bottom: 18px; display: block; }
        .password-input {
            width: 100%; padding: 13px 16px; font-size: 0.95rem; font-weight: 600;
            background: var(--surface); color: var(--t1); border: 1px solid var(--border);
            border-radius: var(--r-md); font-family: 'Space Grotesk', sans-serif;
            margin-bottom: 11px; outline: none; transition: all 0.2s;
            text-align: center; letter-spacing: 0.08em;
        }
        .password-input:focus { border-color: var(--border-g); box-shadow: 0 0 0 3px rgba(0,229,160,0.1); }
        .password-input.err { border-color: rgba(248,113,113,0.4); }
        .password-error { background: var(--red-d); border: 1px solid rgba(248,113,113,0.2); border-radius: 7px; padding: 9px; margin-bottom: 11px; color: var(--red); font-size: 0.8rem; }
        .password-btn {
            width: 100%; padding: 13px; font-size: 0.9rem; font-weight: 700;
            background: var(--accent); color: #090912; border: none; border-radius: var(--r-md);
            cursor: pointer; font-family: 'Space Grotesk', sans-serif; transition: all 0.2s; letter-spacing: 0.02em;
        }
        .password-btn:hover { background: #00ffb2; transform: translateY(-1px); box-shadow: 0 4px 20px rgba(0,229,160,0.3); }
        .password-help { margin-top: 18px; color: var(--t3); font-size: 0.73rem; line-height: 1.6; }

        /* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 968px) {
            .app-layout { flex-direction: column; }
            .sidebar {
                width: 100%; height: auto; display: none;
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                height: 100vh; z-index: 999; overflow-y: auto;
                padding: 20px; border-right: none;
            }
            .sidebar.mobile-open { display: flex; }
            .sidebar-close { display: block; }
            .mobile-menu-toggle { display: flex; }
            .main-content { padding: 20px 14px; }
            .header h1 { font-size: 1.6rem; }
        }

        @media (max-width: 480px) {
            .month-btn { font-size: 0.72rem; padding: 9px 3px; min-height: 40px; }
            .summary-value { font-size: 0.9rem; }
            .group-summary-grid { gap: 5px; }
        }

        @keyframes shake {
            0%,100% { transform: translateX(0); }
            25%      { transform: translateX(-8px); }
            75%      { transform: translateX(8px); }
        }
        @keyframes fadeIn {
            from { opacity:0; transform: translateY(5px); }
            to   { opacity:1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.22s ease both; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const MEMBERS = ['Tokyo', 'Berlin', 'Gandia', 'Denver', 'Helsinki', 'Oslo', 
                        'Moscow', 'California', 'Lisbon', 'Stockholm', 'Paris', 'Marseille', 
                        'Rio', 'Nairobi', 'Tel Aviv', 'Valencia', 'Havana', 'Manilla', 'Scofield', 
                        'Bogota', 'Emirates', 'Dublin', 'Doha', 'Bern'];
        const MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 
                       'July', 'August', 'September', 'October', 'November', 'December'];
        
        const ENCODED_CSV_URLS = [
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTE4ODE3NjExNTQmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTExODIwNzc2Mjcmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTExNDkyMjYwMjQmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTk2MjExMTcwNCZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTUxNDQ5Mjc4MiZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTU5OTQ2MTg1NyZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTcwMzc5MjUzMCZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTIwOTM3MDg5Nzkmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTEwNzkyMzcwNDMmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg==",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTM2MjM4OTY0MCZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTM1MDMxNTkyMiZzaW5nbGU9dHJ1ZSZvdXRwdXQ9Y3N2",
            "aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvZS8yUEFDWC0xdlN2RXUzZVhzd0FRSXZ6Y2dZVE5ZSkFNTEhad0F6Z0REOExxVWl1MHRtQzhTalRXVWlfWjFZQkowWlJoeW93ZkpBNUJJT1VQVkp5N3R2ai9wdWI/Z2lkPTEwMTY1NjE3OTgmc2luZ2xlPXRydWUmb3V0cHV0PWNzdg=="
        ];
        
        const decodeURL = (encoded) => atob(encoded);
        const calculateMovingAverage = (data, windowSize = 2) => {
            if (data.length < windowSize) return data;
            const result = [];
            for (let i = 0; i < data.length; i++) {
                if (data[i] === null) { result.push(null); }
                else if (i < windowSize - 1) { result.push(data[i]); }
                else {
                    const window = data.slice(i - windowSize + 1, i + 1).filter(v => v !== null);
                    result.push(window.reduce((s,v) => s+v, 0) / window.length);
                }
            }
            return result;
        };
        
        const MONTH_CSV_URLS = {};
        MONTHS.forEach((month, index) => { MONTH_CSV_URLS[month] = decodeURL(ENCODED_CSV_URLS[index]); });
        
        const MINIMUM_CONTRIBUTION = 4000;
        const ETICA_ANNUAL_YIELD   = 0.12;
        const ETICA_MONTHLY_YIELD  = ETICA_ANNUAL_YIELD / 12;
        const WARNING_START_DAY    = 10;
        
        const MEMBER_PAIRS = {
            'California': 'Lisbon', 'Lisbon': 'California',
            'Paris': 'Marseille',   'Marseille': 'Paris'
        };

        const PARTIAL_CONTRIBUTION_MESSAGES = [
            (a,r) => `Hey there! ðŸ‘‹ You've put in KES ${a.toLocaleString()} this month. Just KES ${r.toLocaleString()} more and you're all set for interest. You've got this! ðŸ’ª`,
            (a,r) => `Nice start! ðŸŒŸ You're at KES ${a.toLocaleString()} so far. Top up KES ${r.toLocaleString()} more to unlock this month's interest. Almost there!`,
            (a,r) => `Good progress! ðŸŽ¯ Your KES ${a.toLocaleString()} is working. Add KES ${r.toLocaleString()} more to hit the minimum and earn interest. Keep going!`,
            (a,r) => `You're on the right track! ðŸš€ KES ${a.toLocaleString()} down, KES ${r.toLocaleString()} to go. Top up soon!`,
            (a,r) => `Almost there! ðŸ˜Š You've contributed KES ${a.toLocaleString()}. Just KES ${r.toLocaleString()} more to qualify for interest this month!`
        ];
        
        const CURRENT_YEAR = new Date().getFullYear();
        function getCurrentMonth() { return MONTHS[new Date().getMonth()]; }

        const CORRECT_PASSWORD  = 'LikeMinded2026';
        const AUTH_EXPIRY_DAYS  = 30;

        const ARCHETYPE_MESSAGES = {
            OVERACHIEVER: [
                { icon: 'ðŸ†', text: "You're in the top 3! At this pace, you're on track for **{projected}** by December. Your early deposits are earning you way more interest than late contributors." },
                { icon: 'ðŸ’Ž', text: "Star performer! You've earned **{interest}** in interest so far. Keep this up!" },
                { icon: 'ðŸš€', text: "Your balance is growing faster than **{percentBeaten}%** of the group. December projection: **{projected}**." },
                { icon: 'ðŸ”¥', text: "On fire! You're projected to hit **{projected}** by December. **{stretchGoal}** is totally within reach." },
                { icon: 'ðŸ‘‘', text: "Top tier! You've contributed **{totalTopups}** so far. December you will have **{projected}**. That's a serious emergency fund." },
            ],
            STEADY_CLIMBER: [
                { icon: 'ðŸŒ±', text: "Solid progress! Projected **{projected}** by December. Just **KES 1,000 more/month** pushes that to **{stretchGoal}**." },
                { icon: 'ðŸ’ª', text: "Consistent wins! If you deposited **3 days earlier** each month, you'd earn **KES 200+ more interest** by December." },
                { icon: 'ðŸ“ˆ', text: "Steady climb! Your average deposit is **{avgDeposit}**/month. December: **{projected}** with **{projectedInterest}** in interest." },
                { icon: 'ðŸš¶', text: "One step at a time! On track for **{projected}** by December. **{monthsLeft}** months of steady contributions away." },
                { icon: 'ðŸŽŠ', text: "You're doing great! **{percentBeaten}%** of members are behind you. Keep going and you'll crack **{projected}** by December." }
            ],
            LATE_BLOOMER: [
                { icon: 'ðŸ”¥', text: "Look at you go! From **{previousMonthTopup}** last month to **{currentMonthTopup}** this month. Keep this momentum and you'll hit **{projected}** by December." },
                { icon: 'ðŸŒ…', text: "Late bloomer alert! You're gaining speed. **{avgDeposit}**/month â†’ **{projected}** by year-end." },
                { icon: 'ðŸ“ˆ', text: "Upward trajectory! Last: **{previousMonthTopup}**. Now: **{currentMonthTopup}**. Next month? Hit **{suggestedNextDeposit}** and you're on a roll." },
                { icon: 'ðŸŽ¯', text: "You're catching up fast! **{totalTopups}** total â†’ **{projected}** by December. That's real money!" },
                { icon: 'ðŸŽ‰', text: "Progress party! You've more than doubled your deposit this month. December: **{projected}**." }
            ],
            PARTIAL_CONTRIBUTOR: [
                { icon: 'ðŸŽ¯', text: "You've put in {currentMonthTopup} this month. Just {gapToMinimum} away from qualifying for interest. Doable!" },
                { icon: 'ðŸ’š', text: "Good news: {similarMembers} members started at your level and hit the minimum by month-end. Just {gapToMinimum} more!" },
                { icon: 'â°', text: "You still have time left in the month. {gapToMinimum} is all you need to qualify for interest." },
                { icon: 'ðŸŒ±', text: "Every shilling counts! Add {gapToMinimum} more and you'll earn interest this month." },
                { icon: 'ðŸ’ª', text: "You're {gapToMinimum} away from interest. Hit it and you'll start earning on {currentBalance}." }
            ],
            GHOST: [
                { icon: 'ðŸ‘‹', text: "It's not too late! Start with just {minimum} this month. By December, that becomes real money plus interest." },
                { icon: 'â°', text: "Every month you wait costs you growth. Deposit {minimum} now and December you will thank today you." },
                { icon: 'ðŸ’ª', text: "No judgment, just math: {minimum}/month for {monthsLeft} months = {lateStartProjection} by December. Still worth it!" },
                { icon: 'ðŸŽ¯', text: "Your seat is still warm! Deposit {minimum} this month. Even starting late, you'll have {lateStartProjection} by year-end." },
                { icon: 'âœ¨', text: "The best time to start was January. The second best time is today. {minimum} gets you in the game." }
            ],
            EARLY_BIRD: [
                { icon: 'ðŸ¦', text: "Early bird gets the interest! Your deposit is earning more than late-month deposits. December: **{projected}**!" },
                { icon: 'â°', text: "Perfect timing! You're earning more interest than average just by depositing early. That's free money for good habits." },
                { icon: 'ðŸŽ¯', text: "Nailed it! Early deposits mean more earning days. On track for **{projected}** by December." },
                { icon: 'ðŸ’Ž', text: "Premium timing! You're maximizing interest by depositing early. December you: **{projected}**." },
            ],
            BIG_DEPOSITOR: [
                { icon: 'ðŸ‹', text: "Whale alert! Your {currentBalance} is the group's backbone. Projected {projected} by December." },
                { icon: 'ðŸ‘‘', text: "Your {avgDeposit}/month is above average. December you: {projected}. Respect!" },
                { icon: 'ðŸŒŸ', text: "Star power! Your {totalTopups} in contributions are setting the pace. Projected {projected} by December." },
            ],
            ACCELERATOR: [
                { icon: 'ðŸš€', text: "Momentum builder! From {previousMonthTopup} to {currentMonthTopup} this month. Keep this and you'll blow past {projected}!" },
                { icon: 'ðŸ“ˆ', text: "You're scaling up! Deposits growing {percentIncrease}% month-over-month. December could surprise with {stretchGoal}." },
                { icon: 'ðŸ”¥', text: "On fire! Contributions jumped from {previousMonthTopup} to {currentMonthTopup}. Hit {stretchGoal} by year-end." },
            ],
            STEADY_CONTRIBUTOR: [
                { icon: 'ðŸŽ¯', text: "Consistency wins! You've hit {avgDeposit} like clockwork. December: {projected}." },
                { icon: 'âš™ï¸', text: "Autopilot mode. Your steady {avgDeposit}/month is compounding nicely. By December: {projected}+." },
                { icon: 'ðŸ†', text: "Steady wins the race. {avgDeposit} deposits earning you {projected} by year-end." }
            ],
            DECELERATOR: [
                { icon: 'âš ï¸', text: "Heads up! You dropped from {previousMonthTopup} to {currentMonthTopup} this month. Try to get back on track." },
                { icon: 'ðŸ’¡', text: "Your balance is still growing, but slower. Bump back to {suggestedNextDeposit}/month to hit {projected}." },
                { icon: 'ðŸ›¤ï¸', text: "You're slipping a bit. Get back to {minimum}+ and December you hits {projected}." }
            ],
            VOLATILE: [
                { icon: 'ðŸŽ¢', text: "Rollercoaster rider! Try smoothing to {avgDeposit} consistently for better growth to {projected}." },
                { icon: 'ðŸŽ²', text: "Wildcard! Aim for {minimum}+ steadily to maximize compound interest." },
            ]
        };

        function getAuthToken() {
            try {
                const raw = localStorage.getItem('mmf_auth');
                if (!raw) return null;
                const token = JSON.parse(raw);
                if (new Date().getTime() > token.expiresAt) { localStorage.removeItem('mmf_auth'); return null; }
                return token;
            } catch(e) { localStorage.removeItem('mmf_auth'); return null; }
        }

        function setAuthToken() {
            localStorage.setItem('mmf_auth', JSON.stringify({
                authenticated: true,
                expiresAt: new Date().getTime() + (AUTH_EXPIRY_DAYS * 86400000)
            }));
        }

        function calculateMemberArchetype(memberData, allMembersData, currentMonth) {
            const { totalTopups, currentMonthTopup, closingBalance, daysActive, previousMonthTopup } = memberData;
            const monthIndex = MONTHS.indexOf(currentMonth);
            const monthsElapsed = monthIndex + 1;
            const sortedMembers = [...allMembersData].sort((a,b) => b.closingBalance - a.closingBalance);
            const rank = sortedMembers.findIndex(m => m.closingBalance === closingBalance) + 1;
            if (totalTopups === 0) return 'GHOST';
            if (currentMonthTopup > 0 && currentMonthTopup < MINIMUM_CONTRIBUTION) return 'PARTIAL_CONTRIBUTOR';
            if (monthIndex > 0 && previousMonthTopup !== undefined) {
                const trendChange  = currentMonthTopup - previousMonthTopup;
                const trendPercent = previousMonthTopup > 0 ? (trendChange / previousMonthTopup) * 100 : 0;
                if (Math.abs(trendPercent) > 50 && monthIndex > 1) return 'VOLATILE';
                if (trendChange > 0 && trendPercent > 20) return 'ACCELERATOR';
                if (trendChange < 0 && trendPercent < -20 && currentMonthTopup >= MINIMUM_CONTRIBUTION) return 'DECELERATOR';
            }
            const avgDeposit = monthsElapsed > 0 ? totalTopups / monthsElapsed : 0;
            if (rank <= 3 && closingBalance > 0) return 'OVERACHIEVER';
            if (daysActive <= 5 && currentMonthTopup >= MINIMUM_CONTRIBUTION) return 'EARLY_BIRD';
            if (avgDeposit > MINIMUM_CONTRIBUTION * 2) return 'BIG_DEPOSITOR';
            if (currentMonthTopup >= MINIMUM_CONTRIBUTION) {
                const variance = Math.abs(currentMonthTopup - avgDeposit) / (avgDeposit || 1);
                return variance < 0.15 ? 'STEADY_CONTRIBUTOR' : 'STEADY_CLIMBER';
            }
            return 'STEADY_CLIMBER';
        }

        function formatArchetypeMessage(archetype, memberData, allMembersData, currentMonth) {
            try {
                const messages = ARCHETYPE_MESSAGES[archetype] || ARCHETYPE_MESSAGES.STEADY_CLIMBER;
                let available = messages;
                const monthIndex = MONTHS.indexOf(currentMonth);
                if (monthIndex === 0) {
                    const trendTypes = ['LATE_BLOOMER','ACCELERATOR','DECELERATOR','VOLATILE'];
                    if (trendTypes.includes(archetype)) {
                        available = messages.filter(m => !m.text.includes('{previousMonthTopup}') && !m.text.includes('{previousInterest}'));
                        if (!available.length) available = ARCHETYPE_MESSAGES.STEADY_CLIMBER;
                    }
                }
                const msg = available[Math.floor(Math.random() * available.length)];
                const monthsElapsed   = monthIndex + 1;
                const monthsRemaining = 12 - monthsElapsed;
                const avgDeposit      = monthsElapsed > 0 ? (memberData.totalTopups || 0) / monthsElapsed : 0;
                const projected       = (memberData.closingBalance || 0) + (avgDeposit * monthsRemaining);
                const stretchGoal     = (memberData.closingBalance || 0) + ((avgDeposit * 1.5) * monthsRemaining);
                const suggestedNext   = Math.round((memberData.currentMonthTopup || 0) * 1.2);
                const prevTopup       = memberData.previousMonthTopup || 0;
                const balanceIncrease = prevTopup > 0 ? Math.round(((memberData.currentMonthTopup - prevTopup) / prevTopup) * 100) : 0;
                const estimatedInterest = ((memberData.closingBalance||0) + (avgDeposit*monthsRemaining)) * ETICA_MONTHLY_YIELD * monthsRemaining;
                const shareOfTotal    = allMembersData.length > 0 ? Math.round(((memberData.closingBalance||0) / allMembersData.reduce((s,m)=>s+(m.closingBalance||0),0))*100) : 0;
                const lateStart       = MINIMUM_CONTRIBUTION * monthsRemaining + (MINIMUM_CONTRIBUTION * monthsRemaining * ETICA_MONTHLY_YIELD * (monthsRemaining/2));
                let text = msg.text
                    .replace(/{projected}/g,           `KES ${Math.round(projected).toLocaleString()}`)
                    .replace(/{stretchGoal}/g,         `KES ${Math.round(stretchGoal).toLocaleString()}`)
                    .replace(/{totalTopups}/g,         `KES ${(memberData.totalTopups||0).toLocaleString()}`)
                    .replace(/{currentMonthTopup}/g,   `KES ${(memberData.currentMonthTopup||0).toLocaleString()}`)
                    .replace(/{previousMonthTopup}/g,  `KES ${prevTopup.toLocaleString()}`)
                    .replace(/{interest}/g,            `KES ${(memberData.totalInterest||0).toLocaleString()}`)
                    .replace(/{currentInterest}/g,     `KES ${(memberData.currentInterest||0).toLocaleString()}`)
                    .replace(/{avgDeposit}/g,          `KES ${Math.round(avgDeposit).toLocaleString()}`)
                    .replace(/{monthsLeft}/g,          monthsRemaining.toString())
                    .replace(/{minimum}/g,             `KES ${MINIMUM_CONTRIBUTION.toLocaleString()}`)
                    .replace(/{gapToMinimum}/g,        `KES ${Math.max(0, MINIMUM_CONTRIBUTION-(memberData.currentMonthTopup||0)).toLocaleString()}`)
                    .replace(/{currentBalance}/g,      `KES ${(memberData.closingBalance||0).toLocaleString()}`)
                    .replace(/{suggestedNextDeposit}/g,`KES ${suggestedNext.toLocaleString()}`)
                    .replace(/{balanceIncrease}/g,     balanceIncrease.toString())
                    .replace(/{percentIncrease}/g,     balanceIncrease.toString())
                    .replace(/{similarMembers}/g,      (Math.floor(Math.random()*5)+3).toString())
                    .replace(/{shareOfTotal}/g,        shareOfTotal.toString())
                    .replace(/{projectedInterest}/g,   `KES ${Math.round(estimatedInterest).toLocaleString()}`)
                    .replace(/{lateStartProjection}/g, `KES ${Math.round(lateStart).toLocaleString()}`)
                    .replace(/\*\*/g, '');
                return { icon: msg.icon, text };
            } catch(e) {
                return { icon: 'ðŸ“Š', text: `You're on track for KES ${Math.round((memberData.closingBalance||0)+40000).toLocaleString()} by December. Keep going!` };
            }
        }

        /* â”€â”€ PASSWORD SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function PasswordScreen({ onSuccess }) {
            const [password, setPassword] = useState('');
            const [error, setError]       = useState('');
            const [shake, setShake]       = useState(false);
            const handleSubmit = (e) => {
                e.preventDefault();
                if (password === CORRECT_PASSWORD) { setAuthToken(); onSuccess(); }
                else {
                    setError('Incorrect password. Please try again or contact admin.');
                    setShake(true); setTimeout(() => setShake(false), 500); setPassword('');
                }
            };
            return (
                <div className="password-screen">
                    <div className="password-card fade-in" style={{ animation: shake ? 'shake 0.5s' : undefined }}>
                        <span className="password-lock">ðŸ”’</span>
                        <div className="password-title">Like-Minded Folks</div>
                        <div className="password-subtitle">MMF Account Tracker Â· Members Only</div>
                        <form onSubmit={handleSubmit}>
                            <input type="password" value={password} onChange={e => setPassword(e.target.value)}
                                placeholder="Enter password" autoFocus
                                className={`password-input${error ? ' err' : ''}`} />
                            {error && <div className="password-error">âŒ {error}</div>}
                            <button type="submit" className="password-btn">Access Tracker â†’</button>
                        </form>
                        <p className="password-help">Don't have the password?<br/>Contact your group admin</p>
                    </div>
                    <style>{`@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}`}</style>
                </div>
            );
        }

        function AppWithAuth() {
            const [showTour, setShowTour] = useState(() => !localStorage.getItem('mmf_tour_seen'));
            return <App showTour={showTour} onTourDone={() => { localStorage.setItem('mmf_tour_seen','true'); setShowTour(false); }} />;
        }

        /* â”€â”€ SITE TOUR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function SiteTour({ onDone, openSidebar, closeSidebar, onSidebarStepChange }) {
            const [step, setStep] = useState(0);
            const [highlightRect, setHighlightRect] = useState(null);
            const tooltipRef = React.useRef(null);
            const TOUR_STEPS = [
                { selector:'.month-selector',           title:'Pick a Month',      text:"Tap any month to view that month's data.", position:'below', sidebar:false },
                { selector:'.view-toggle',              title:'Switch Views',      text:"Member View = your balance. All Members = everyone side by side.", position:'below', sidebar:false },
                { selector:'.alias-selector',           title:'Select Your Alias', text:"Choose your alias to see your personal balance card.", position:'below', sidebar:false },
                { selector:'.sidebar-section:nth-child(2)', title:'Track Activity',  text:"Open the shared tracker to see contribution activity.", position:'below', sidebar:true },
                { selector:'.sidebar-section:nth-child(3)', title:'Make a Deposit',  text:"M-PESA and bank deposit details. Always use 308398M as reference.", position:'below', sidebar:true },
                { selector:'.sidebar-section:nth-child(4)', title:'Group Rules',     text:"Quick reference for contribution minimums and withdrawal policy.", position:'below', sidebar:true },
                { selector:'.sidebar-section:nth-child(5)', title:'Etica Statements',text:"Download official monthly statements from Etica here.", position:'below', sidebar:true }
            ];
            useEffect(() => {
                const isMobile = window.innerWidth <= 968;
                if (isMobile && TOUR_STEPS[step].sidebar) openSidebar(); else if (isMobile) closeSidebar();
                onSidebarStepChange(TOUR_STEPS[step].sidebar);
            }, [step]);
            useEffect(() => {
                const t = setTimeout(positionHighlight, 350);
                window.addEventListener('resize', positionHighlight);
                return () => { clearTimeout(t); window.removeEventListener('resize', positionHighlight); };
            }, [step]);
            function positionHighlight() {
                const el = document.querySelector(TOUR_STEPS[step].selector);
                if (el) { const r = el.getBoundingClientRect(); setHighlightRect({ top:r.top+window.scrollY-6, left:r.left-6, width:r.width+12, height:r.height+12 }); }
            }
            function getTooltipStyle() {
                if (!highlightRect) return { top:'50%', left:'50%', transform:'translate(-50%,-50%)' };
                const base = { left: Math.max(10, Math.min(highlightRect.left, window.innerWidth-300))+'px' };
                if (TOUR_STEPS[step].position === 'below') base.top = (highlightRect.top + highlightRect.height + 14)+'px';
                else base.top = (highlightRect.top - 180)+'px';
                return base;
            }
            const cur = TOUR_STEPS[step]; const isLast = step === TOUR_STEPS.length-1;
            function handleNext() { if (isLast) { closeSidebar(); onSidebarStepChange(false); onDone(); } else setStep(s=>s+1); }
            function handleDone() { closeSidebar(); onSidebarStepChange(false); onDone(); }
            return (
                <>
                    <div className="tour-overlay" onClick={handleDone} />
                    {highlightRect && <div className="tour-highlight" style={{top:highlightRect.top+'px',left:highlightRect.left+'px',width:highlightRect.width+'px',height:highlightRect.height+'px'}} />}
                    <div className="tour-tooltip" style={getTooltipStyle()} ref={tooltipRef}>
                        <div className={`tour-tooltip-arrow arrow-${cur.position==='below'?'top':'bottom'}`} />
                        <div className="tour-step-badge">STEP {step+1} OF {TOUR_STEPS.length}</div>
                        <h4>{cur.title}</h4><p>{cur.text}</p>
                        <div className="tour-controls">
                            <button className="tour-btn-skip" onClick={handleDone}>Skip tour</button>
                            <div style={{display:'flex',alignItems:'center',gap:'12px'}}>
                                <div className="tour-dots">{TOUR_STEPS.map((_,i)=><div key={i} className={`tour-dot${i===step?' active':''}`}/>)}</div>
                                <button className="tour-btn-next" onClick={handleNext}>{isLast?'ðŸŽ‰ Done':'Next â†’'}</button>
                            </div>
                        </div>
                    </div>
                </>
            );
        }

        /* â”€â”€ MAIN APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function App({ showTour, onTourDone }) {
            const [data, setData]                   = useState(null);
            const [loading, setLoading]             = useState(true);
            const [error, setError]                 = useState(null);
            const [selectedMonth, setSelectedMonth] = useState(getCurrentMonth());
            const [selectedAlias, setSelectedAlias] = useState('');
            const [view, setView]                   = useState('member');
            const [fileLastModified, setFileLastModified] = useState(null);
            const [mobileMenuOpen, setMobileMenuOpen]     = useState(false);
            const [tourSidebarActive, setTourSidebarActive] = useState(false);

            useEffect(() => { loadDataFromGoogleSheets(); }, []);

            const loadDataFromGoogleSheets = async () => {
                try {
                    setLoading(true); setError(null);
                    const parsedData = {};
                    const results = await Promise.all(MONTHS.map(async month => {
                        const url  = MONTH_CSV_URLS[month];
                        const resp = await fetch(`${url}&_=${Date.now()}`);
                        if (!resp.ok) throw new Error(`Could not load ${month} data`);
                        const text  = await resp.text();
                        const lines = text.split('\n').filter(l => l.trim());
                        const mdata = {};
                        for (let i = 3; i < lines.length; i++) {
                            const cols  = parseCSVLine(lines[i]);
                            const alias = cols[0]?.trim().replace(/"/g,'');
                            if (alias && MEMBERS.includes(alias)) {
                                const n = s => parseFloat((s||'').replace(/["',\s]/g,'')) || 0;
                                mdata[alias] = {
                                    openingBalance: n(cols[1]), topups: n(cols[2]),
                                    interest: n(cols[3]), daysActive: parseInt((cols[4]||'').replace(/[",\s]/g,''))||0,
                                    closingBalance: n(cols[5])
                                };
                            }
                        }
                        return { month, monthData: mdata };
                    }));
                    results.forEach(({ month, monthData }) => { parsedData[month] = monthData; });
                    setData(parsedData); setFileLastModified(new Date()); setLoading(false);
                } catch(err) {
                    console.error(err);
                    setError('Unable to load data from Google Sheets. Please refresh or contact the admin.');
                    setLoading(false);
                }
            };

            const parseCSVLine = (line) => {
                const result = []; let cur = ''; let inQ = false;
                for (const ch of line) {
                    if (ch === '"') inQ = !inQ;
                    else if (ch === ',' && !inQ) { result.push(cur); cur=''; }
                    else cur += ch;
                }
                result.push(cur); return result;
            };

            const getAllMembersData = (month) => MEMBERS.map(alias => ({
                alias, ...(data[month]?.[alias] || { openingBalance:0, topups:0, interest:0, daysActive:0, closingBalance:0 })
            })).sort((a,b) => b.closingBalance - a.closingBalance);

            const calculateGroupStats = () => {
                if (!data || !data[selectedMonth]) return null;
                const members  = getAllMembersData(selectedMonth);
                const monthTopups   = members.reduce((s,m)=>s+m.topups, 0);
                const monthInterest = members.reduce((s,m)=>s+m.interest, 0);
                const totalBalance  = members.reduce((s,m)=>s+m.closingBalance, 0);
                const idx = MONTHS.indexOf(selectedMonth);
                let cumContrib = 0, cumInterest = 0;
                for (let i=0; i<=idx; i++) {
                    if (data[MONTHS[i]]) {
                        const mm = getAllMembersData(MONTHS[i]);
                        cumContrib  += mm.reduce((s,m)=>s+m.topups, 0);
                        cumInterest += mm.reduce((s,m)=>s+m.interest, 0);
                    }
                }
                return { monthTopups, monthInterest, cumulativeContributions:cumContrib, cumulativeInterest:cumInterest, totalAmount:cumContrib+cumInterest, totalBalance };
            };

            const isCurrentMonth   = m => m === getCurrentMonth();
            const shouldShowWarnings = () => new Date().getDate() >= WARNING_START_DAY;

            if (loading) return (
                <div className="app-layout"><div className="main-content"><div className="loading"><div className="loading-spinner"/><div className="loading-text">Loading your dataâ€¦</div></div></div></div>
            );
            if (error) return (
                <div className="app-layout"><div className="main-content"><div className="error"><p>{error}</p><button className="btn-secondary" onClick={loadDataFromGoogleSheets}>â†º Retry</button></div></div></div>
            );

            const stats = calculateGroupStats();
            return (
                <>
                    <div className="app-layout">
                        {/* SIDEBAR */}
                        <aside className={`sidebar${mobileMenuOpen?' mobile-open':''}`} style={tourSidebarActive?{zIndex:10001}:{}}>
                            <div className="sidebar-close"><button onClick={()=>setMobileMenuOpen(false)}>âœ• Close</button></div>
                            <div className="sidebar-logo">
                                <div className="sidebar-logo-icon">ðŸ’°</div>
                                <div><div className="sidebar-logo-text">Like-Minded Folks</div><div className="sidebar-logo-sub">MMF Account Tracker</div></div>
                            </div>

                            <div className="sidebar-section">
                                <h3>ðŸ“Š Activity</h3>
                                <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vQfQdBVl01cxsIoGnfJLltGDuOkIVDFqj-rNg3KwFVZ8-GGbUqk1DSs_CVaygisjaLhg30g1gjzIsdC/pubhtml?gid=2079453016&single=true"
                                   target="_blank" rel="noopener noreferrer" className="sidebar-link">View Contributions â†—</a>
                            </div>

                            <div className="sidebar-section">
                                <h3>ðŸ’³ Make a Deposit</h3>
                                <div className="deposit-method">
                                    <div className="deposit-title">M-PESA</div>
                                    <div className="deposit-info">Paybill: <strong>4096483</strong><br/>Account: <strong>308398M</strong></div>
                                </div>
                                <div className="deposit-method">
                                    <div className="deposit-title">Bank Transfer</div>
                                    <div className="deposit-info">Bank: <strong>Equity Bank</strong><br/>A/C Name: Etica Unit Trust Collection<br/>A/C No: <strong>0180 28395 1027</strong><br/>Reference: <strong>308398M</strong></div>
                                    <div className="deposit-warn">âš ï¸ Always use <strong>308398M</strong> as reference</div>
                                </div>
                            </div>

                            <div className="sidebar-section">
                                <h3>ðŸ“œ Rules</h3>
                                <ul className="rules-list">
                                    <li>Min. contribution: <strong>KES 4,000/month</strong></li>
                                    <li>Interest only with minimum contribution</li>
                                    <li>Withdrawals: December (before Week 3)</li>
                                    <li>Fund: <strong>Etica MMF</strong></li>
                                    <li>Max members: <strong>15</strong></li>
                                </ul>
                            </div>

                            <div className="sidebar-section">
                                <h3>ðŸ“„ Etica Statements</h3>
                                <div className="pdf-password">Password: 308398</div>
                                <select className="statements-dropdown" onChange={(e) => {
                                    if (!e.target.value) return;
                                    const sel = e.target.value;
                                    const url = `${sel}_${CURRENT_YEAR}_Statement.pdf`;
                                    fetch(url,{method:'HEAD'}).then(r => {
                                        if (r.ok) window.open(url,'_blank');
                                        else {
                                            const msgs = [
                                                `ðŸ“Š The ${sel} statement is still cookingâ€¦ Check back soon! ðŸ³`,
                                                `â³ ${sel}'s numbers are being crunchedâ€¦ Almost ready! ðŸ§®`,
                                                `ðŸŽ¬ ${sel} statement: Coming soon! ðŸŽ¥`,
                                                `ðŸ“ Dotting the i's on ${sel}â€¦ Patience! âœï¸`,
                                                `â° ${sel} statement: Under construction! ðŸ‘·`
                                            ];
                                            alert(msgs[Math.floor(Math.random()*msgs.length)]);
                                        }
                                    }).catch(()=>window.open(url,'_blank'));
                                    e.target.value='';
                                }}>
                                    <option value="">ðŸ“¥ Select Month to Download</option>
                                    {MONTHS.map(m=><option key={m} value={m} style={{background:'#131320',color:'#f0f0f8'}}>{m}</option>)}
                                </select>
                            </div>
                        </aside>

                        {/* MAIN CONTENT */}
                        <main className="main-content">
                            <div className="header">
                                <div className="header-eyebrow">MMF Account Tracker Â· {CURRENT_YEAR}</div>
                                <h1>Like-Minded Folks</h1>
                                <div className="header-sub">Track contributions, interest &amp; projections</div>
                            </div>

                            {/* MONTH SELECTOR â€” 2 rows Ã— 6 cols */}
                            <div className="month-selector">
                                {MONTHS.map(month => (
                                    <button key={month}
                                        className={`month-btn${selectedMonth===month?' active':''}`}
                                        onClick={() => setSelectedMonth(month)}>
                                        {month.slice(0,3)}
                                    </button>
                                ))}
                            </div>

                            <div className="view-toggle">
                                <button className={`toggle-btn${view==='member'?' active':''}`} onClick={()=>setView('member')}>ðŸ“± My Balance</button>
                                <button className={`toggle-btn${view==='all'?' active':''}`}    onClick={()=>setView('all')}>ðŸ‘¥ All Members</button>
                            </div>

                            {view==='member' && <MemberView month={selectedMonth} selectedAlias={selectedAlias} setSelectedAlias={setSelectedAlias} data={data} stats={stats} fileLastModified={fileLastModified} isCurrentMonth={isCurrentMonth(selectedMonth)} shouldShowWarnings={shouldShowWarnings()} />}
                            {view==='all'    && <AllMembersView month={selectedMonth} members={getAllMembersData(selectedMonth)} fileLastModified={fileLastModified} data={data} />}
                        </main>
                    </div>

                    {showTour && <SiteTour onDone={onTourDone} openSidebar={()=>setMobileMenuOpen(true)} closeSidebar={()=>setMobileMenuOpen(false)} onSidebarStepChange={setTourSidebarActive} />}
                    <button className="mobile-menu-toggle" onClick={()=>setMobileMenuOpen(!mobileMenuOpen)}>â˜°</button>
                </>
            );
        }

        /* â”€â”€ MEMBER PROJECTION CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function MemberProjectionChart({ selectedAlias, data, currentMonth }) {
            const chartRef         = React.useRef(null);
            const chartInstanceRef = React.useRef(null);

            React.useEffect(() => {
                if (!chartRef.current || !selectedAlias || !data) return;
                if (chartInstanceRef.current) chartInstanceRef.current.destroy();

                const ctx        = chartRef.current.getContext('2d');
                const monthIndex = MONTHS.indexOf(currentMonth);
                const labels     = MONTHS.map(m => m.slice(0,3));

                // â”€â”€ Dataset 1: monthly deposit bars (actual + projected avg)
                let totalTopups = 0;
                const actualDeposits = [];
                for (let i = 0; i <= monthIndex; i++) {
                    const md = data[MONTHS[i]]?.[selectedAlias] || { topups: 0 };
                    actualDeposits.push(md.topups);
                    totalTopups += md.topups;
                }
                const avg = (monthIndex + 1) > 0 ? totalTopups / (monthIndex + 1) : 0;
                const barData = [
                    ...actualDeposits,
                    ...Array(12 - actualDeposits.length).fill(avg)
                ];
                const barColors = barData.map((v, i) =>
                    i <= monthIndex
                        ? (v >= MINIMUM_CONTRIBUTION ? 'rgba(0,229,160,0.7)' : v > 0 ? 'rgba(245,158,11,0.7)' : 'rgba(248,113,113,0.5)')
                        : 'rgba(96,165,250,0.25)'
                );
                const barBorders = barData.map((v, i) =>
                    i <= monthIndex
                        ? (v >= MINIMUM_CONTRIBUTION ? '#00e5a0' : v > 0 ? '#f59e0b' : '#f87171')
                        : 'rgba(96,165,250,0.5)'
                );

                // â”€â”€ Dataset 2: running balance (contributions + interest) to date
                const actualBalance = [];
                for (let i = 0; i <= monthIndex; i++) {
                    const md = data[MONTHS[i]]?.[selectedAlias] || {};
                    actualBalance.push(md.closingBalance || 0);
                }
                const balanceLine = [...actualBalance, ...Array(12 - actualBalance.length).fill(null)];

                // â”€â”€ Dataset 3: projected balance from current month forward
                const lastBalance = actualBalance[actualBalance.length - 1] || 0;
                const projLine    = Array(12).fill(null);
                projLine[monthIndex] = lastBalance;
                for (let i = monthIndex + 1; i < 12; i++) {
                    const prev = projLine[i - 1];
                    projLine[i] = prev + avg + (prev * ETICA_MONTHLY_YIELD);
                }

                chartInstanceRef.current = new Chart(ctx, {
                    data: {
                        labels,
                        datasets: [
                            {
                                type: 'bar',
                                label: 'Monthly Deposit',
                                data: barData,
                                backgroundColor: barColors,
                                borderColor: barBorders,
                                borderWidth: 1.5,
                                borderRadius: 4,
                                yAxisID: 'yDeposit',
                                order: 3,
                            },
                            {
                                type: 'line',
                                label: 'Balance to Date',
                                data: balanceLine,
                                borderColor: '#00e5a0',
                                backgroundColor: 'rgba(0,229,160,0.06)',
                                borderWidth: 2.5,
                                pointBackgroundColor: '#00e5a0',
                                pointRadius: 3,
                                pointHoverRadius: 5,
                                fill: true,
                                tension: 0.35,
                                yAxisID: 'yBalance',
                                order: 1,
                                spanGaps: false,
                            },
                            {
                                type: 'line',
                                label: 'Projected Balance',
                                data: projLine,
                                borderColor: '#60a5fa',
                                backgroundColor: 'transparent',
                                borderWidth: 2,
                                borderDash: [5, 4],
                                pointBackgroundColor: '#60a5fa',
                                pointRadius: 2,
                                pointHoverRadius: 4,
                                fill: false,
                                tension: 0.35,
                                yAxisID: 'yBalance',
                                order: 2,
                                spanGaps: false,
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: { mode: 'index', intersect: false },
                        plugins: {
                            legend: {
                                display: true, position: 'top',
                                labels: { color: 'rgba(240,240,248,0.5)', font: { size: 10, family: 'Space Grotesk' }, boxWidth: 10, padding: 12 }
                            },
                            tooltip: {
                                backgroundColor: '#1a1a2e', titleColor: '#00e5a0',
                                bodyColor: '#f0f0f8', borderColor: 'rgba(0,229,160,0.25)', borderWidth: 1,
                                callbacks: {
                                    label: ctx => {
                                        const v = ctx.parsed.y;
                                        if (v === null || v === undefined) return null;
                                        return `${ctx.dataset.label}: KES ${Math.round(v).toLocaleString()}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            yDeposit: {
                                type: 'linear', position: 'right',
                                beginAtZero: true,
                                ticks: { color: 'rgba(240,240,248,0.3)', font: { size: 8 }, callback: v => (v/1000).toFixed(0)+'k' },
                                grid: { display: false },
                                title: { display: false }
                            },
                            yBalance: {
                                type: 'linear', position: 'left',
                                beginAtZero: false,
                                ticks: { color: 'rgba(240,240,248,0.3)', font: { size: 8 }, callback: v => 'KES '+(v/1000).toFixed(0)+'k' },
                                grid: { color: 'rgba(255,255,255,0.04)' },
                            },
                            x: {
                                ticks: { color: 'rgba(240,240,248,0.35)', font: { size: 9 } },
                                grid: { display: false }
                            }
                        }
                    }
                });
                return () => { if (chartInstanceRef.current) chartInstanceRef.current.destroy(); };
            }, [selectedAlias, data, currentMonth]);

            if (!selectedAlias) return null;

            const monthIndex = MONTHS.indexOf(currentMonth);
            const hist = { totalTopups:0, totalInterest:0, currentMonthTopup:0, currentInterest:0, previousMonthTopup:0, previousInterest:0, closingBalance:0, daysActive:0 };
            for (let i=0; i<=monthIndex; i++) {
                const md = data[MONTHS[i]]?.[selectedAlias] || {};
                hist.totalTopups  += md.topups||0; hist.totalInterest += md.interest||0;
                if (i===monthIndex) { hist.currentMonthTopup=md.topups||0; hist.currentInterest=md.interest||0; hist.closingBalance=md.closingBalance||0; hist.daysActive=md.daysActive||0; }
                if (i===monthIndex-1) { hist.previousMonthTopup=md.topups||0; hist.previousInterest=md.interest||0; }
            }
            const allMD      = MEMBERS.map(a=>({ alias:a, closingBalance:data[currentMonth]?.[a]?.closingBalance||0 }));
            const archetype  = calculateMemberArchetype(hist, allMD, currentMonth);
            const motivation = formatArchetypeMessage(archetype, hist, allMD, currentMonth);

            return (
                <div style={{marginTop:'14px'}}>
                    <div className="chart-card">
                        <div className="chart-card-label">Contributions &amp; Balance Growth</div>
                        <div className="chart-card-sub">Bars = monthly deposits Â· Lines = balance to date &amp; projected</div>
                        <div style={{height:'240px', position:'relative'}}><canvas ref={chartRef}/></div>
                    </div>
                    <div className="motivation-card">
                        <span className="motivation-icon">{motivation.icon}</span>
                        <p className="motivation-text">{motivation.text}</p>
                    </div>
                </div>
            );
        }

        /* â”€â”€ MEMBER VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function MemberView({ month, selectedAlias, setSelectedAlias, data, stats, fileLastModified, isCurrentMonth, shouldShowWarnings }) {
            const md = data[month]?.[selectedAlias] || { openingBalance:0, topups:0, interest:0, daysActive:0, closingBalance:0 };
            const partner = MEMBER_PAIRS[selectedAlias];
            let showWarning=false, warningMsg='';
            if (isCurrentMonth && shouldShowWarnings && selectedAlias) {
                if (partner) {
                    const pd = data[month]?.[partner] || {topups:0};
                    const combined = md.topups + pd.topups;
                    if (combined>0 && combined<MINIMUM_CONTRIBUTION) {
                        showWarning=true;
                        const rmsg = PARTIAL_CONTRIBUTION_MESSAGES[Math.floor(Math.random()*PARTIAL_CONTRIBUTION_MESSAGES.length)];
                        warningMsg = rmsg(combined, MINIMUM_CONTRIBUTION-combined)+` (Combined with ${partner})`;
                    } else if (combined===0) {
                        showWarning=true;
                        warningMsg = `Your combined ${month} contribution with ${partner} hasn't been recorded yet. Please coordinate to deposit KES ${MINIMUM_CONTRIBUTION.toLocaleString()} soon.`;
                    }
                } else {
                    if (md.topups>0 && md.topups<MINIMUM_CONTRIBUTION) {
                        showWarning=true;
                        const rmsg = PARTIAL_CONTRIBUTION_MESSAGES[Math.floor(Math.random()*PARTIAL_CONTRIBUTION_MESSAGES.length)];
                        warningMsg = rmsg(md.topups, MINIMUM_CONTRIBUTION-md.topups);
                    } else if (md.topups===0) {
                        showWarning=true;
                        warningMsg = `Your ${month} contribution hasn't been recorded yet. Please deposit at least KES ${MINIMUM_CONTRIBUTION.toLocaleString()} soon.`;
                    }
                }
            }
            return (
                <div className="member-view">
                    <div className="alias-selector">
                        <select value={selectedAlias} onChange={e=>setSelectedAlias(e.target.value)}>
                            <option value="" disabled>Select your alias to view balance</option>
                            {MEMBERS.map(a=><option key={a} value={a}>{a}</option>)}
                        </select>
                    </div>

                    {selectedAlias && (
                        <>
                            <div className="member-statement fade-in">
                                <div className="statement-alias">{selectedAlias}</div>
                                <div className="statement-month">{month} {CURRENT_YEAR}</div>
                                <div className="statement-row">
                                    <span className="statement-label">Opening Balance</span>
                                    <span className="statement-value">{md.openingBalance.toLocaleString('en-KE',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                                <div className="statement-row">
                                    <span className="statement-label">Top-ups</span>
                                    <span className="statement-value blue">{md.topups.toLocaleString('en-KE',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                                <div className="statement-row">
                                    <span className="statement-label">
                                        Interest Earned
                                        <div className="early-hint">Early deposits earn more</div>
                                    </span>
                                    <span className="statement-value green">{md.interest.toLocaleString('en-KE',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                                <div className="statement-row">
                                    <span className="statement-label" style={{fontWeight:'700',color:'var(--t1)',fontSize:'1rem'}}>Current Balance</span>
                                    <span className="statement-value closing">{md.closingBalance.toLocaleString('en-KE',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
                                </div>
                                {fileLastModified && <div className="data-timestamp">Data as of {fileLastModified.toLocaleString('en-KE',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit',hour12:true})}</div>}
                            </div>
                            <div className="privacy-notice">ðŸ” <strong>Privacy Notice:</strong> This site is for LMF members only. Keep it confidential. Do not share links or screenshots outside LMF.</div>

                            {showWarning && (
                                <div className="warning-message">
                                    <div className="warning-icon">âš ï¸</div>
                                    <div><div className="warning-title">Friendly Reminder</div><div className="warning-content">{warningMsg}</div></div>
                                </div>
                            )}
                        </>
                    )}

                    {selectedAlias && <MemberProjectionChart selectedAlias={selectedAlias} data={data} currentMonth={month} />}

                    {!selectedAlias && stats && (
                        <div className="group-summary fade-in">
                            <div className="group-summary-title">Group Summary Â· Jan â€“ {month}</div>
                            <div className="group-summary-grid">
                                <div className="summary-item">
                                    <div className="summary-label">Total Contributions</div>
                                    <div className="summary-value">KES {stats.cumulativeContributions.toLocaleString('en-KE',{maximumFractionDigits:0})}</div>
                                </div>
                                <div className="summary-item">
                                    <div className="summary-label">Total Interest</div>
                                    <div className="summary-value">KES {stats.cumulativeInterest.toLocaleString('en-KE',{maximumFractionDigits:0})}</div>
                                </div>
                                <div className="summary-item">
                                    <div className="summary-label">Group Balance</div>
                                    <div className="summary-value">KES {stats.totalBalance.toLocaleString('en-KE',{maximumFractionDigits:0})}</div>
                                </div>
                            </div>
                        </div>
                    )}
                    {!selectedAlias && (
                        <div className="privacy-notice">ðŸ” <strong>Privacy Notice:</strong> This site is for LMF members only. Keep it confidential. Do not share links or screenshots outside LMF.</div>
                    )}
                </div>
            );
        }

        /* â”€â”€ GROUP BALANCE CHART â€” line graph, month-by-month total + projected â”€â”€ */
        function GroupBalanceChart({ data, currentMonth }) {
            const chartRef         = React.useRef(null);
            const chartInstanceRef = React.useRef(null);

            React.useEffect(() => {
                if (!chartRef.current || !data) return;
                if (chartInstanceRef.current) chartInstanceRef.current.destroy();
                const ctx        = chartRef.current.getContext('2d');
                const monthIndex = MONTHS.indexOf(currentMonth);
                const labels     = MONTHS.map(m => m.slice(0,3));

                // Actual month-by-month group totals (balance)
                const actualBalances = [];
                for (let i=0; i<=monthIndex; i++) {
                    let total = 0;
                    MEMBERS.forEach(a => { total += data[MONTHS[i]]?.[a]?.closingBalance || 0; });
                    actualBalances.push(total);
                }

                // Projection from current month forward
                let totalContribs = 0;
                for (let i=0; i<=monthIndex; i++) MEMBERS.forEach(a => { totalContribs += data[MONTHS[i]]?.[a]?.topups || 0; });
                const avgMonthly = (monthIndex+1) > 0 ? totalContribs / (monthIndex+1) : 0;

                const actualData     = [...actualBalances, ...Array(12 - actualBalances.length).fill(null)];
                const projectedData  = Array(12).fill(null);
                // Start projection at last actual point
                projectedData[monthIndex] = actualBalances[actualBalances.length - 1];
                for (let i = monthIndex+1; i < 12; i++) {
                    const prev = projectedData[i-1];
                    projectedData[i] = prev + avgMonthly + (prev * ETICA_MONTHLY_YIELD);
                }

                chartInstanceRef.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [
                            {
                                label: 'Actual Group Balance',
                                data: actualData,
                                borderColor: '#00e5a0',
                                backgroundColor: 'rgba(0,229,160,0.08)',
                                borderWidth: 2.5,
                                pointBackgroundColor: '#00e5a0',
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                fill: true,
                                tension: 0.35,
                                spanGaps: false,
                            },
                            {
                                label: 'Projected Balance',
                                data: projectedData,
                                borderColor: '#60a5fa',
                                backgroundColor: 'rgba(96,165,250,0.05)',
                                borderWidth: 2,
                                borderDash: [6, 4],
                                pointBackgroundColor: '#60a5fa',
                                pointRadius: 3,
                                pointHoverRadius: 5,
                                fill: false,
                                tension: 0.35,
                                spanGaps: false,
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: { mode: 'index', intersect: false },
                        plugins: {
                            legend: { display: true, position: 'top', labels: { color: 'rgba(240,240,248,0.55)', font:{size:11,family:'Space Grotesk'}, boxWidth:12, padding:16 } },
                            tooltip: {
                                backgroundColor: '#1a1a2e', titleColor: '#00e5a0',
                                bodyColor: '#f0f0f8', borderColor: 'rgba(0,229,160,0.25)', borderWidth: 1,
                                callbacks: { label: ctx => `${ctx.dataset.label}: KES ${(ctx.parsed.y||0).toLocaleString('en-KE',{maximumFractionDigits:0})}` }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: { color:'rgba(240,240,248,0.35)', font:{size:9}, callback: v => 'KES '+(v/1000).toFixed(0)+'k' },
                                grid: { color:'rgba(255,255,255,0.04)' }
                            },
                            x: {
                                ticks: { color:'rgba(240,240,248,0.35)', font:{size:9} },
                                grid: { display:false }
                            }
                        }
                    }
                });
                return () => { if (chartInstanceRef.current) chartInstanceRef.current.destroy(); };
            }, [data, currentMonth]);

            // Compute summary for subtitle
            const monthIndex   = MONTHS.indexOf(currentMonth);
            const monthsElapsed = monthIndex + 1;
            let totalContribs   = 0;
            for (let i=0; i<=monthIndex; i++) MEMBERS.forEach(a => { totalContribs += data[MONTHS[i]]?.[a]?.topups || 0; });
            const avg = monthsElapsed > 0 ? totalContribs / monthsElapsed : 0;
            const curBal = MEMBERS.reduce((s,a) => s + (data[currentMonth]?.[a]?.closingBalance||0), 0);
            const projDec = curBal + (avg * (12-monthsElapsed)) + (curBal * ETICA_MONTHLY_YIELD * (12-monthsElapsed));

            return (
                <div className="chart-card" style={{marginBottom:'16px'}}>
                    <div className="chart-card-label">Group Balance â€” Month by Month</div>
                    <div className="chart-card-sub">Actual (green) + Projected to Dec (blue) Â· Projected Dec total: KES {Math.round(projDec).toLocaleString()}</div>
                    <div style={{height:'260px', position:'relative'}}><canvas ref={chartRef}/></div>
                </div>
            );
        }

        /* â”€â”€ ALL MEMBERS VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        function AllMembersView({ month, members, fileLastModified, data }) {
            const [searchQuery, setSearchQuery] = React.useState('');
            const filtered = members.filter(m => m.alias.toLowerCase().includes(searchQuery.toLowerCase()));
            const totalOpening = filtered.reduce((s,m)=>s+m.openingBalance, 0);
            const totalTopups  = filtered.reduce((s,m)=>s+m.topups, 0);
            const totalInt     = filtered.reduce((s,m)=>s+m.interest, 0);
            const totalClosing = filtered.reduce((s,m)=>s+m.closingBalance, 0);

            return (
                <div>
                    <div className="all-members-header">
                        <div className="all-members-title">{month} {CURRENT_YEAR}</div>
                        <div className="search-wrapper">
                            <div className="search-input-wrap">
                                <input type="text" placeholder="Search aliasâ€¦" value={searchQuery}
                                    onChange={e=>setSearchQuery(e.target.value)} className="search-input" />
                                {searchQuery && <button onClick={()=>setSearchQuery('')} className="search-clear">Ã—</button>}
                            </div>
                            <span className="search-count">{filtered.length}/{members.length}</span>
                        </div>
                    </div>

                    <GroupBalanceChart data={data} currentMonth={month} />

                    <div className="members-table-container">
                        <table className="members-table">
                            <thead>
                                <tr>
                                    <th className="rank-col">#</th>
                                    <th>Alias</th>
                                    <th className="num-col">Opening</th>
                                    <th className="num-col">Top-ups</th>
                                    <th className="num-col">{month.slice(0,3)} Int.</th>
                                    <th className="num-col">Balance</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filtered.map((member, idx) => {
                                    const dotColor = member.topups >= MINIMUM_CONTRIBUTION ? '#00e5a0' : member.topups > 0 ? '#f59e0b' : '#f87171';
                                    const dotTitle = member.topups >= MINIMUM_CONTRIBUTION ? 'âœ… Met minimum' : member.topups > 0 ? 'âš ï¸ Partial' : 'âŒ No contribution';
                                    const rank = idx + 1;
                                    return (
                                        <tr key={member.alias}>
                                            <td className="rank-col">{rank<=3?['ðŸ¥‡','ðŸ¥ˆ','ðŸ¥‰'][rank-1]:rank}</td>
                                            <td className="alias-col">{member.alias}</td>
                                            <td className="num-col">{member.openingBalance.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                                            <td className="num-col">
                                                <div className="topup-cell">
                                                    {member.topups.toLocaleString('en-KE',{maximumFractionDigits:0})}
                                                    <span className="status-dot" title={dotTitle} style={{backgroundColor:dotColor}}/>
                                                </div>
                                            </td>
                                            <td className="num-col">{member.interest.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                                            <td className="num-col closing">{member.closingBalance.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                                        </tr>
                                    );
                                })}
                                <tr className="total-row">
                                    <td/>
                                    <td>TOTALS</td>
                                    <td className="num-col">{totalOpening.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                                    <td className="num-col">{totalTopups.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                                    <td className="num-col">{totalInt.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                                    <td className="num-col">{totalClosing.toLocaleString('en-KE',{maximumFractionDigits:0})}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    {fileLastModified && (
                        <div className="data-timestamp" style={{textAlign:'center',marginTop:'8px'}}>
                            Data as of {fileLastModified.toLocaleString('en-KE',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit',hour12:true})}
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<AppWithAuth />, document.getElementById('root'));
    </script>
</body>
</html>
